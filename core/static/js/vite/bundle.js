import{m as se,i as vi,f as _i,u as yi,E as ys,T as mi,a as ur,b as dr,x as D,c as wi}from"./assets/vendor-t-ZPRVt5.js";(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const a of n.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function t(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=t(i);fetch(i.href,n)}})();const bi="modulepreload",ki=function(r){return"/"+r},ms={},Ge=function(e,t,s){let i=Promise.resolve();if(t&&t.length>0){let l=function(u){return Promise.all(u.map(d=>Promise.resolve(d).then(c=>({status:"fulfilled",value:c}),c=>({status:"rejected",reason:c}))))};document.getElementsByTagName("link");const a=document.querySelector("meta[property=csp-nonce]"),o=a?.nonce||a?.getAttribute("nonce");i=l(t.map(u=>{if(u=ki(u),u in ms)return;ms[u]=!0;const d=u.endsWith(".css"),c=d?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${u}"]${c}`))return;const f=document.createElement("link");if(f.rel=d?"stylesheet":bi,d||(f.as="script"),f.crossOrigin="",f.href=u,o&&f.setAttribute("nonce",o),document.head.appendChild(f),d)return new Promise((h,p)=>{f.addEventListener("load",h),f.addEventListener("error",()=>p(new Error(`Unable to preload CSS for ${u}`)))})}))}function n(a){const o=new Event("vite:preloadError",{cancelable:!0});if(o.payload=a,window.dispatchEvent(o),!o.defaultPrevented)throw a}return i.then(a=>{for(const o of a||[])o.status==="rejected"&&n(o.reason);return e().catch(n)})},Si=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ge(async()=>{const{default:s}=await Promise.resolve().then(()=>be);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)};class Lt extends Error{constructor(e,t="FunctionsError",s){super(e),this.name=t,this.context=s}}class Pi extends Lt{constructor(e){super("Failed to send a request to the Edge Function","FunctionsFetchError",e)}}class ws extends Lt{constructor(e){super("Relay Error invoking the Edge Function","FunctionsRelayError",e)}}class bs extends Lt{constructor(e){super("Edge Function returned a non-2xx status code","FunctionsHttpError",e)}}var yt;(function(r){r.Any="any",r.ApNortheast1="ap-northeast-1",r.ApNortheast2="ap-northeast-2",r.ApSouth1="ap-south-1",r.ApSoutheast1="ap-southeast-1",r.ApSoutheast2="ap-southeast-2",r.CaCentral1="ca-central-1",r.EuCentral1="eu-central-1",r.EuWest1="eu-west-1",r.EuWest2="eu-west-2",r.EuWest3="eu-west-3",r.SaEast1="sa-east-1",r.UsEast1="us-east-1",r.UsWest1="us-west-1",r.UsWest2="us-west-2"})(yt||(yt={}));var Ei=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};class Oi{constructor(e,{headers:t={},customFetch:s,region:i=yt.Any}={}){this.url=e,this.headers=t,this.region=i,this.fetch=Si(s)}setAuth(e){this.headers.Authorization=`Bearer ${e}`}invoke(e,t={}){var s;return Ei(this,void 0,void 0,function*(){try{const{headers:i,method:n,body:a}=t;let o={},{region:l}=t;l||(l=this.region);const u=new URL(`${this.url}/${e}`);l&&l!=="any"&&(o["x-region"]=l,u.searchParams.set("forceFunctionRegion",l));let d;a&&(i&&!Object.prototype.hasOwnProperty.call(i,"Content-Type")||!i)&&(typeof Blob<"u"&&a instanceof Blob||a instanceof ArrayBuffer?(o["Content-Type"]="application/octet-stream",d=a):typeof a=="string"?(o["Content-Type"]="text/plain",d=a):typeof FormData<"u"&&a instanceof FormData?d=a:(o["Content-Type"]="application/json",d=JSON.stringify(a)));const c=yield this.fetch(u.toString(),{method:n||"POST",headers:Object.assign(Object.assign(Object.assign({},o),this.headers),i),body:d}).catch(m=>{throw new Pi(m)}),f=c.headers.get("x-relay-error");if(f&&f==="true")throw new ws(c);if(!c.ok)throw new bs(c);let h=((s=c.headers.get("Content-Type"))!==null&&s!==void 0?s:"text/plain").split(";")[0].trim(),p;return h==="application/json"?p=yield c.json():h==="application/octet-stream"?p=yield c.blob():h==="text/event-stream"?p=c:h==="multipart/form-data"?p=yield c.formData():p=yield c.text(),{data:p,error:null,response:c}}catch(i){return{data:null,error:i,response:i instanceof bs||i instanceof ws?i.context:void 0}}})}}function $i(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}function Ti(r){if(Object.prototype.hasOwnProperty.call(r,"__esModule"))return r;var e=r.default;if(typeof e=="function"){var t=function s(){var i=!1;try{i=this instanceof s}catch{}return i?Reflect.construct(e,arguments,this.constructor):e.apply(this,arguments)};t.prototype=e.prototype}else t={};return Object.defineProperty(t,"__esModule",{value:!0}),Object.keys(r).forEach(function(s){var i=Object.getOwnPropertyDescriptor(r,s);Object.defineProperty(t,s,i.get?i:{enumerable:!0,get:function(){return r[s]}})}),t}var O={},ne={},ae={},oe={},ce={},le={},xi=function(){if(typeof self<"u")return self;if(typeof window<"u")return window;if(typeof global<"u")return global;throw new Error("unable to locate global object")},me=xi();const ji=me.fetch,hr=me.fetch.bind(me),fr=me.Headers,Ci=me.Request,Ii=me.Response,be=Object.freeze(Object.defineProperty({__proto__:null,Headers:fr,Request:Ci,Response:Ii,default:hr,fetch:ji},Symbol.toStringTag,{value:"Module"})),Ai=Ti(be);var Ze={},ks;function gr(){if(ks)return Ze;ks=1,Object.defineProperty(Ze,"__esModule",{value:!0});class r extends Error{constructor(t){super(t.message),this.name="PostgrestError",this.details=t.details,this.hint=t.hint,this.code=t.code}}return Ze.default=r,Ze}var Ss;function pr(){if(Ss)return le;Ss=1;var r=le&&le.__importDefault||function(i){return i&&i.__esModule?i:{default:i}};Object.defineProperty(le,"__esModule",{value:!0});const e=r(Ai),t=r(gr());class s{constructor(n){this.shouldThrowOnError=!1,this.method=n.method,this.url=n.url,this.headers=n.headers,this.schema=n.schema,this.body=n.body,this.shouldThrowOnError=n.shouldThrowOnError,this.signal=n.signal,this.isMaybeSingle=n.isMaybeSingle,n.fetch?this.fetch=n.fetch:typeof fetch>"u"?this.fetch=e.default:this.fetch=fetch}throwOnError(){return this.shouldThrowOnError=!0,this}setHeader(n,a){return this.headers=Object.assign({},this.headers),this.headers[n]=a,this}then(n,a){this.schema===void 0||(["GET","HEAD"].includes(this.method)?this.headers["Accept-Profile"]=this.schema:this.headers["Content-Profile"]=this.schema),this.method!=="GET"&&this.method!=="HEAD"&&(this.headers["Content-Type"]="application/json");const o=this.fetch;let l=o(this.url.toString(),{method:this.method,headers:this.headers,body:JSON.stringify(this.body),signal:this.signal}).then(async u=>{var d,c,f;let h=null,p=null,m=null,y=u.status,S=u.statusText;if(u.ok){if(this.method!=="HEAD"){const b=await u.text();b===""||(this.headers.Accept==="text/csv"||this.headers.Accept&&this.headers.Accept.includes("application/vnd.pgrst.plan+text")?p=b:p=JSON.parse(b))}const _=(d=this.headers.Prefer)===null||d===void 0?void 0:d.match(/count=(exact|planned|estimated)/),g=(c=u.headers.get("content-range"))===null||c===void 0?void 0:c.split("/");_&&g&&g.length>1&&(m=parseInt(g[1])),this.isMaybeSingle&&this.method==="GET"&&Array.isArray(p)&&(p.length>1?(h={code:"PGRST116",details:`Results contain ${p.length} rows, application/vnd.pgrst.object+json requires 1 row`,hint:null,message:"JSON object requested, multiple (or no) rows returned"},p=null,m=null,y=406,S="Not Acceptable"):p.length===1?p=p[0]:p=null)}else{const _=await u.text();try{h=JSON.parse(_),Array.isArray(h)&&u.status===404&&(p=[],h=null,y=200,S="OK")}catch{u.status===404&&_===""?(y=204,S="No Content"):h={message:_}}if(h&&this.isMaybeSingle&&(!((f=h?.details)===null||f===void 0)&&f.includes("0 rows"))&&(h=null,y=200,S="OK"),h&&this.shouldThrowOnError)throw new t.default(h)}return{error:h,data:p,count:m,status:y,statusText:S}});return this.shouldThrowOnError||(l=l.catch(u=>{var d,c,f;return{error:{message:`${(d=u?.name)!==null&&d!==void 0?d:"FetchError"}: ${u?.message}`,details:`${(c=u?.stack)!==null&&c!==void 0?c:""}`,hint:"",code:`${(f=u?.code)!==null&&f!==void 0?f:""}`},data:null,count:null,status:0,statusText:""}})),l.then(n,a)}returns(){return this}overrideTypes(){return this}}return le.default=s,le}var Ps;function vr(){if(Ps)return ce;Ps=1;var r=ce&&ce.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ce,"__esModule",{value:!0});const e=r(pr());class t extends e.default{select(i){let n=!1;const a=(i??"*").split("").map(o=>/\s/.test(o)&&!n?"":(o==='"'&&(n=!n),o)).join("");return this.url.searchParams.set("select",a),this.headers.Prefer&&(this.headers.Prefer+=","),this.headers.Prefer+="return=representation",this}order(i,{ascending:n=!0,nullsFirst:a,foreignTable:o,referencedTable:l=o}={}){const u=l?`${l}.order`:"order",d=this.url.searchParams.get(u);return this.url.searchParams.set(u,`${d?`${d},`:""}${i}.${n?"asc":"desc"}${a===void 0?"":a?".nullsfirst":".nullslast"}`),this}limit(i,{foreignTable:n,referencedTable:a=n}={}){const o=typeof a>"u"?"limit":`${a}.limit`;return this.url.searchParams.set(o,`${i}`),this}range(i,n,{foreignTable:a,referencedTable:o=a}={}){const l=typeof o>"u"?"offset":`${o}.offset`,u=typeof o>"u"?"limit":`${o}.limit`;return this.url.searchParams.set(l,`${i}`),this.url.searchParams.set(u,`${n-i+1}`),this}abortSignal(i){return this.signal=i,this}single(){return this.headers.Accept="application/vnd.pgrst.object+json",this}maybeSingle(){return this.method==="GET"?this.headers.Accept="application/json":this.headers.Accept="application/vnd.pgrst.object+json",this.isMaybeSingle=!0,this}csv(){return this.headers.Accept="text/csv",this}geojson(){return this.headers.Accept="application/geo+json",this}explain({analyze:i=!1,verbose:n=!1,settings:a=!1,buffers:o=!1,wal:l=!1,format:u="text"}={}){var d;const c=[i?"analyze":null,n?"verbose":null,a?"settings":null,o?"buffers":null,l?"wal":null].filter(Boolean).join("|"),f=(d=this.headers.Accept)!==null&&d!==void 0?d:"application/json";return this.headers.Accept=`application/vnd.pgrst.plan+${u}; for="${f}"; options=${c};`,u==="json"?this:this}rollback(){var i;return((i=this.headers.Prefer)!==null&&i!==void 0?i:"").trim().length>0?this.headers.Prefer+=",tx=rollback":this.headers.Prefer="tx=rollback",this}returns(){return this}}return ce.default=t,ce}var Es;function Ut(){if(Es)return oe;Es=1;var r=oe&&oe.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(oe,"__esModule",{value:!0});const e=r(vr());class t extends e.default{eq(i,n){return this.url.searchParams.append(i,`eq.${n}`),this}neq(i,n){return this.url.searchParams.append(i,`neq.${n}`),this}gt(i,n){return this.url.searchParams.append(i,`gt.${n}`),this}gte(i,n){return this.url.searchParams.append(i,`gte.${n}`),this}lt(i,n){return this.url.searchParams.append(i,`lt.${n}`),this}lte(i,n){return this.url.searchParams.append(i,`lte.${n}`),this}like(i,n){return this.url.searchParams.append(i,`like.${n}`),this}likeAllOf(i,n){return this.url.searchParams.append(i,`like(all).{${n.join(",")}}`),this}likeAnyOf(i,n){return this.url.searchParams.append(i,`like(any).{${n.join(",")}}`),this}ilike(i,n){return this.url.searchParams.append(i,`ilike.${n}`),this}ilikeAllOf(i,n){return this.url.searchParams.append(i,`ilike(all).{${n.join(",")}}`),this}ilikeAnyOf(i,n){return this.url.searchParams.append(i,`ilike(any).{${n.join(",")}}`),this}is(i,n){return this.url.searchParams.append(i,`is.${n}`),this}in(i,n){const a=Array.from(new Set(n)).map(o=>typeof o=="string"&&new RegExp("[,()]").test(o)?`"${o}"`:`${o}`).join(",");return this.url.searchParams.append(i,`in.(${a})`),this}contains(i,n){return typeof n=="string"?this.url.searchParams.append(i,`cs.${n}`):Array.isArray(n)?this.url.searchParams.append(i,`cs.{${n.join(",")}}`):this.url.searchParams.append(i,`cs.${JSON.stringify(n)}`),this}containedBy(i,n){return typeof n=="string"?this.url.searchParams.append(i,`cd.${n}`):Array.isArray(n)?this.url.searchParams.append(i,`cd.{${n.join(",")}}`):this.url.searchParams.append(i,`cd.${JSON.stringify(n)}`),this}rangeGt(i,n){return this.url.searchParams.append(i,`sr.${n}`),this}rangeGte(i,n){return this.url.searchParams.append(i,`nxl.${n}`),this}rangeLt(i,n){return this.url.searchParams.append(i,`sl.${n}`),this}rangeLte(i,n){return this.url.searchParams.append(i,`nxr.${n}`),this}rangeAdjacent(i,n){return this.url.searchParams.append(i,`adj.${n}`),this}overlaps(i,n){return typeof n=="string"?this.url.searchParams.append(i,`ov.${n}`):this.url.searchParams.append(i,`ov.{${n.join(",")}}`),this}textSearch(i,n,{config:a,type:o}={}){let l="";o==="plain"?l="pl":o==="phrase"?l="ph":o==="websearch"&&(l="w");const u=a===void 0?"":`(${a})`;return this.url.searchParams.append(i,`${l}fts${u}.${n}`),this}match(i){return Object.entries(i).forEach(([n,a])=>{this.url.searchParams.append(n,`eq.${a}`)}),this}not(i,n,a){return this.url.searchParams.append(i,`not.${n}.${a}`),this}or(i,{foreignTable:n,referencedTable:a=n}={}){const o=a?`${a}.or`:"or";return this.url.searchParams.append(o,`(${i})`),this}filter(i,n,a){return this.url.searchParams.append(i,`${n}.${a}`),this}}return oe.default=t,oe}var Os;function _r(){if(Os)return ae;Os=1;var r=ae&&ae.__importDefault||function(s){return s&&s.__esModule?s:{default:s}};Object.defineProperty(ae,"__esModule",{value:!0});const e=r(Ut());class t{constructor(i,{headers:n={},schema:a,fetch:o}){this.url=i,this.headers=n,this.schema=a,this.fetch=o}select(i,{head:n=!1,count:a}={}){const o=n?"HEAD":"GET";let l=!1;const u=(i??"*").split("").map(d=>/\s/.test(d)&&!l?"":(d==='"'&&(l=!l),d)).join("");return this.url.searchParams.set("select",u),a&&(this.headers.Prefer=`count=${a}`),new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}insert(i,{count:n,defaultToNull:a=!0}={}){const o="POST",l=[];if(this.headers.Prefer&&l.push(this.headers.Prefer),n&&l.push(`count=${n}`),a||l.push("missing=default"),this.headers.Prefer=l.join(","),Array.isArray(i)){const u=i.reduce((d,c)=>d.concat(Object.keys(c)),[]);if(u.length>0){const d=[...new Set(u)].map(c=>`"${c}"`);this.url.searchParams.set("columns",d.join(","))}}return new e.default({method:o,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}upsert(i,{onConflict:n,ignoreDuplicates:a=!1,count:o,defaultToNull:l=!0}={}){const u="POST",d=[`resolution=${a?"ignore":"merge"}-duplicates`];if(n!==void 0&&this.url.searchParams.set("on_conflict",n),this.headers.Prefer&&d.push(this.headers.Prefer),o&&d.push(`count=${o}`),l||d.push("missing=default"),this.headers.Prefer=d.join(","),Array.isArray(i)){const c=i.reduce((f,h)=>f.concat(Object.keys(h)),[]);if(c.length>0){const f=[...new Set(c)].map(h=>`"${h}"`);this.url.searchParams.set("columns",f.join(","))}}return new e.default({method:u,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}update(i,{count:n}={}){const a="PATCH",o=[];return this.headers.Prefer&&o.push(this.headers.Prefer),n&&o.push(`count=${n}`),this.headers.Prefer=o.join(","),new e.default({method:a,url:this.url,headers:this.headers,schema:this.schema,body:i,fetch:this.fetch,allowEmpty:!1})}delete({count:i}={}){const n="DELETE",a=[];return i&&a.push(`count=${i}`),this.headers.Prefer&&a.unshift(this.headers.Prefer),this.headers.Prefer=a.join(","),new e.default({method:n,url:this.url,headers:this.headers,schema:this.schema,fetch:this.fetch,allowEmpty:!1})}}return ae.default=t,ae}var xe={},je={},$s;function Ri(){return $s||($s=1,Object.defineProperty(je,"__esModule",{value:!0}),je.version=void 0,je.version="0.0.0-automated"),je}var Ts;function Di(){if(Ts)return xe;Ts=1,Object.defineProperty(xe,"__esModule",{value:!0}),xe.DEFAULT_HEADERS=void 0;const r=Ri();return xe.DEFAULT_HEADERS={"X-Client-Info":`postgrest-js/${r.version}`},xe}var xs;function Li(){if(xs)return ne;xs=1;var r=ne&&ne.__importDefault||function(n){return n&&n.__esModule?n:{default:n}};Object.defineProperty(ne,"__esModule",{value:!0});const e=r(_r()),t=r(Ut()),s=Di();class i{constructor(a,{headers:o={},schema:l,fetch:u}={}){this.url=a,this.headers=Object.assign(Object.assign({},s.DEFAULT_HEADERS),o),this.schemaName=l,this.fetch=u}from(a){const o=new URL(`${this.url}/${a}`);return new e.default(o,{headers:Object.assign({},this.headers),schema:this.schemaName,fetch:this.fetch})}schema(a){return new i(this.url,{headers:this.headers,schema:a,fetch:this.fetch})}rpc(a,o={},{head:l=!1,get:u=!1,count:d}={}){let c;const f=new URL(`${this.url}/rpc/${a}`);let h;l||u?(c=l?"HEAD":"GET",Object.entries(o).filter(([m,y])=>y!==void 0).map(([m,y])=>[m,Array.isArray(y)?`{${y.join(",")}}`:`${y}`]).forEach(([m,y])=>{f.searchParams.append(m,y)})):(c="POST",h=o);const p=Object.assign({},this.headers);return d&&(p.Prefer=`count=${d}`),new t.default({method:c,url:f,headers:p,schema:this.schemaName,body:h,fetch:this.fetch,allowEmpty:!1})}}return ne.default=i,ne}var js;function Ui(){if(js)return O;js=1;var r=O&&O.__importDefault||function(o){return o&&o.__esModule?o:{default:o}};Object.defineProperty(O,"__esModule",{value:!0}),O.PostgrestError=O.PostgrestBuilder=O.PostgrestTransformBuilder=O.PostgrestFilterBuilder=O.PostgrestQueryBuilder=O.PostgrestClient=void 0;const e=r(Li());O.PostgrestClient=e.default;const t=r(_r());O.PostgrestQueryBuilder=t.default;const s=r(Ut());O.PostgrestFilterBuilder=s.default;const i=r(vr());O.PostgrestTransformBuilder=i.default;const n=r(pr());O.PostgrestBuilder=n.default;const a=r(gr());return O.PostgrestError=a.default,O.default={PostgrestClient:e.default,PostgrestQueryBuilder:t.default,PostgrestFilterBuilder:s.default,PostgrestTransformBuilder:i.default,PostgrestBuilder:n.default,PostgrestError:a.default},O}var Mi=Ui();const Fi=$i(Mi),{PostgrestClient:Bi,PostgrestQueryBuilder:nc,PostgrestFilterBuilder:ac,PostgrestTransformBuilder:oc,PostgrestBuilder:cc,PostgrestError:lc}=Fi;function Ni(){if(typeof WebSocket<"u")return WebSocket;if(typeof global.WebSocket<"u")return global.WebSocket;if(typeof window.WebSocket<"u")return window.WebSocket;if(typeof self.WebSocket<"u")return self.WebSocket;throw new Error("`WebSocket` is not supported in this environment")}const qi=Ni(),Wi="2.11.15",zi=`realtime-js/${Wi}`,Hi="1.0.0",yr=1e4,Gi=1e3;var Be;(function(r){r[r.connecting=0]="connecting",r[r.open=1]="open",r[r.closing=2]="closing",r[r.closed=3]="closed"})(Be||(Be={}));var j;(function(r){r.closed="closed",r.errored="errored",r.joined="joined",r.joining="joining",r.leaving="leaving"})(j||(j={}));var M;(function(r){r.close="phx_close",r.error="phx_error",r.join="phx_join",r.reply="phx_reply",r.leave="phx_leave",r.access_token="access_token"})(M||(M={}));var mt;(function(r){r.websocket="websocket"})(mt||(mt={}));var te;(function(r){r.Connecting="connecting",r.Open="open",r.Closing="closing",r.Closed="closed"})(te||(te={}));class Ji{constructor(){this.HEADER_LENGTH=1}decode(e,t){return e.constructor===ArrayBuffer?t(this._binaryDecode(e)):t(typeof e=="string"?JSON.parse(e):{})}_binaryDecode(e){const t=new DataView(e),s=new TextDecoder;return this._decodeBroadcast(e,t,s)}_decodeBroadcast(e,t,s){const i=t.getUint8(1),n=t.getUint8(2);let a=this.HEADER_LENGTH+2;const o=s.decode(e.slice(a,a+i));a=a+i;const l=s.decode(e.slice(a,a+n));a=a+n;const u=JSON.parse(s.decode(e.slice(a,e.byteLength)));return{ref:null,topic:o,event:l,payload:u}}}class mr{constructor(e,t){this.callback=e,this.timerCalc=t,this.timer=void 0,this.tries=0,this.callback=e,this.timerCalc=t}reset(){this.tries=0,clearTimeout(this.timer)}scheduleTimeout(){clearTimeout(this.timer),this.timer=setTimeout(()=>{this.tries=this.tries+1,this.callback()},this.timerCalc(this.tries+1))}}var P;(function(r){r.abstime="abstime",r.bool="bool",r.date="date",r.daterange="daterange",r.float4="float4",r.float8="float8",r.int2="int2",r.int4="int4",r.int4range="int4range",r.int8="int8",r.int8range="int8range",r.json="json",r.jsonb="jsonb",r.money="money",r.numeric="numeric",r.oid="oid",r.reltime="reltime",r.text="text",r.time="time",r.timestamp="timestamp",r.timestamptz="timestamptz",r.timetz="timetz",r.tsrange="tsrange",r.tstzrange="tstzrange"})(P||(P={}));const Cs=(r,e,t={})=>{var s;const i=(s=t.skipTypes)!==null&&s!==void 0?s:[];return Object.keys(e).reduce((n,a)=>(n[a]=Ki(a,r,e,i),n),{})},Ki=(r,e,t,s)=>{const i=e.find(o=>o.name===r),n=i?.type,a=t[r];return n&&!s.includes(n)?wr(n,a):wt(a)},wr=(r,e)=>{if(r.charAt(0)==="_"){const t=r.slice(1,r.length);return Yi(e,t)}switch(r){case P.bool:return Vi(e);case P.float4:case P.float8:case P.int2:case P.int4:case P.int8:case P.numeric:case P.oid:return Qi(e);case P.json:case P.jsonb:return Xi(e);case P.timestamp:return Zi(e);case P.abstime:case P.date:case P.daterange:case P.int4range:case P.int8range:case P.money:case P.reltime:case P.text:case P.time:case P.timestamptz:case P.timetz:case P.tsrange:case P.tstzrange:return wt(e);default:return wt(e)}},wt=r=>r,Vi=r=>{switch(r){case"t":return!0;case"f":return!1;default:return r}},Qi=r=>{if(typeof r=="string"){const e=parseFloat(r);if(!Number.isNaN(e))return e}return r},Xi=r=>{if(typeof r=="string")try{return JSON.parse(r)}catch(e){return console.log(`JSON parse error: ${e}`),r}return r},Yi=(r,e)=>{if(typeof r!="string")return r;const t=r.length-1,s=r[t];if(r[0]==="{"&&s==="}"){let n;const a=r.slice(1,t);try{n=JSON.parse("["+a+"]")}catch{n=a?a.split(","):[]}return n.map(o=>wr(e,o))}return r},Zi=r=>typeof r=="string"?r.replace(" ","T"):r,br=r=>{let e=r;return e=e.replace(/^ws/i,"http"),e=e.replace(/(\/socket\/websocket|\/socket|\/websocket)\/?$/i,""),e.replace(/\/+$/,"")};class ut{constructor(e,t,s={},i=yr){this.channel=e,this.event=t,this.payload=s,this.timeout=i,this.sent=!1,this.timeoutTimer=void 0,this.ref="",this.receivedResp=null,this.recHooks=[],this.refEvent=null}resend(e){this.timeout=e,this._cancelRefEvent(),this.ref="",this.refEvent=null,this.receivedResp=null,this.sent=!1,this.send()}send(){this._hasReceived("timeout")||(this.startTimeout(),this.sent=!0,this.channel.socket.push({topic:this.channel.topic,event:this.event,payload:this.payload,ref:this.ref,join_ref:this.channel._joinRef()}))}updatePayload(e){this.payload=Object.assign(Object.assign({},this.payload),e)}receive(e,t){var s;return this._hasReceived(e)&&t((s=this.receivedResp)===null||s===void 0?void 0:s.response),this.recHooks.push({status:e,callback:t}),this}startTimeout(){if(this.timeoutTimer)return;this.ref=this.channel.socket._makeRef(),this.refEvent=this.channel._replyEventName(this.ref);const e=t=>{this._cancelRefEvent(),this._cancelTimeout(),this.receivedResp=t,this._matchReceive(t)};this.channel._on(this.refEvent,{},e),this.timeoutTimer=setTimeout(()=>{this.trigger("timeout",{})},this.timeout)}trigger(e,t){this.refEvent&&this.channel._trigger(this.refEvent,{status:e,response:t})}destroy(){this._cancelRefEvent(),this._cancelTimeout()}_cancelRefEvent(){this.refEvent&&this.channel._off(this.refEvent,{})}_cancelTimeout(){clearTimeout(this.timeoutTimer),this.timeoutTimer=void 0}_matchReceive({status:e,response:t}){this.recHooks.filter(s=>s.status===e).forEach(s=>s.callback(t))}_hasReceived(e){return this.receivedResp&&this.receivedResp.status===e}}var Is;(function(r){r.SYNC="sync",r.JOIN="join",r.LEAVE="leave"})(Is||(Is={}));class Ne{constructor(e,t){this.channel=e,this.state={},this.pendingDiffs=[],this.joinRef=null,this.caller={onJoin:()=>{},onLeave:()=>{},onSync:()=>{}};const s=t?.events||{state:"presence_state",diff:"presence_diff"};this.channel._on(s.state,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.joinRef=this.channel._joinRef(),this.state=Ne.syncState(this.state,i,n,a),this.pendingDiffs.forEach(l=>{this.state=Ne.syncDiff(this.state,l,n,a)}),this.pendingDiffs=[],o()}),this.channel._on(s.diff,{},i=>{const{onJoin:n,onLeave:a,onSync:o}=this.caller;this.inPendingSyncState()?this.pendingDiffs.push(i):(this.state=Ne.syncDiff(this.state,i,n,a),o())}),this.onJoin((i,n,a)=>{this.channel._trigger("presence",{event:"join",key:i,currentPresences:n,newPresences:a})}),this.onLeave((i,n,a)=>{this.channel._trigger("presence",{event:"leave",key:i,currentPresences:n,leftPresences:a})}),this.onSync(()=>{this.channel._trigger("presence",{event:"sync"})})}static syncState(e,t,s,i){const n=this.cloneDeep(e),a=this.transformState(t),o={},l={};return this.map(n,(u,d)=>{a[u]||(l[u]=d)}),this.map(a,(u,d)=>{const c=n[u];if(c){const f=d.map(y=>y.presence_ref),h=c.map(y=>y.presence_ref),p=d.filter(y=>h.indexOf(y.presence_ref)<0),m=c.filter(y=>f.indexOf(y.presence_ref)<0);p.length>0&&(o[u]=p),m.length>0&&(l[u]=m)}else o[u]=d}),this.syncDiff(n,{joins:o,leaves:l},s,i)}static syncDiff(e,t,s,i){const{joins:n,leaves:a}={joins:this.transformState(t.joins),leaves:this.transformState(t.leaves)};return s||(s=()=>{}),i||(i=()=>{}),this.map(n,(o,l)=>{var u;const d=(u=e[o])!==null&&u!==void 0?u:[];if(e[o]=this.cloneDeep(l),d.length>0){const c=e[o].map(h=>h.presence_ref),f=d.filter(h=>c.indexOf(h.presence_ref)<0);e[o].unshift(...f)}s(o,d,l)}),this.map(a,(o,l)=>{let u=e[o];if(!u)return;const d=l.map(c=>c.presence_ref);u=u.filter(c=>d.indexOf(c.presence_ref)<0),e[o]=u,i(o,u,l),u.length===0&&delete e[o]}),e}static map(e,t){return Object.getOwnPropertyNames(e).map(s=>t(s,e[s]))}static transformState(e){return e=this.cloneDeep(e),Object.getOwnPropertyNames(e).reduce((t,s)=>{const i=e[s];return"metas"in i?t[s]=i.metas.map(n=>(n.presence_ref=n.phx_ref,delete n.phx_ref,delete n.phx_ref_prev,n)):t[s]=i,t},{})}static cloneDeep(e){return JSON.parse(JSON.stringify(e))}onJoin(e){this.caller.onJoin=e}onLeave(e){this.caller.onLeave=e}onSync(e){this.caller.onSync=e}inPendingSyncState(){return!this.joinRef||this.joinRef!==this.channel._joinRef()}}var As;(function(r){r.ALL="*",r.INSERT="INSERT",r.UPDATE="UPDATE",r.DELETE="DELETE"})(As||(As={}));var Rs;(function(r){r.BROADCAST="broadcast",r.PRESENCE="presence",r.POSTGRES_CHANGES="postgres_changes",r.SYSTEM="system"})(Rs||(Rs={}));var q;(function(r){r.SUBSCRIBED="SUBSCRIBED",r.TIMED_OUT="TIMED_OUT",r.CLOSED="CLOSED",r.CHANNEL_ERROR="CHANNEL_ERROR"})(q||(q={}));class Mt{constructor(e,t={config:{}},s){this.topic=e,this.params=t,this.socket=s,this.bindings={},this.state=j.closed,this.joinedOnce=!1,this.pushBuffer=[],this.subTopic=e.replace(/^realtime:/i,""),this.params.config=Object.assign({broadcast:{ack:!1,self:!1},presence:{key:""},private:!1},t.config),this.timeout=this.socket.timeout,this.joinPush=new ut(this,M.join,this.params,this.timeout),this.rejoinTimer=new mr(()=>this._rejoinUntilConnected(),this.socket.reconnectAfterMs),this.joinPush.receive("ok",()=>{this.state=j.joined,this.rejoinTimer.reset(),this.pushBuffer.forEach(i=>i.send()),this.pushBuffer=[]}),this._onClose(()=>{this.rejoinTimer.reset(),this.socket.log("channel",`close ${this.topic} ${this._joinRef()}`),this.state=j.closed,this.socket._remove(this)}),this._onError(i=>{this._isLeaving()||this._isClosed()||(this.socket.log("channel",`error ${this.topic}`,i),this.state=j.errored,this.rejoinTimer.scheduleTimeout())}),this.joinPush.receive("timeout",()=>{this._isJoining()&&(this.socket.log("channel",`timeout ${this.topic}`,this.joinPush.timeout),this.state=j.errored,this.rejoinTimer.scheduleTimeout())}),this._on(M.reply,{},(i,n)=>{this._trigger(this._replyEventName(n),i)}),this.presence=new Ne(this),this.broadcastEndpointURL=br(this.socket.endPoint)+"/api/broadcast",this.private=this.params.config.private||!1}subscribe(e,t=this.timeout){var s,i;if(this.socket.isConnected()||this.socket.connect(),this.state==j.closed){const{config:{broadcast:n,presence:a,private:o}}=this.params;this._onError(d=>e?.(q.CHANNEL_ERROR,d)),this._onClose(()=>e?.(q.CLOSED));const l={},u={broadcast:n,presence:a,postgres_changes:(i=(s=this.bindings.postgres_changes)===null||s===void 0?void 0:s.map(d=>d.filter))!==null&&i!==void 0?i:[],private:o};this.socket.accessTokenValue&&(l.access_token=this.socket.accessTokenValue),this.updateJoinPayload(Object.assign({config:u},l)),this.joinedOnce=!0,this._rejoin(t),this.joinPush.receive("ok",async({postgres_changes:d})=>{var c;if(this.socket.setAuth(),d===void 0){e?.(q.SUBSCRIBED);return}else{const f=this.bindings.postgres_changes,h=(c=f?.length)!==null&&c!==void 0?c:0,p=[];for(let m=0;m<h;m++){const y=f[m],{filter:{event:S,schema:v,table:_,filter:g}}=y,b=d&&d[m];if(b&&b.event===S&&b.schema===v&&b.table===_&&b.filter===g)p.push(Object.assign(Object.assign({},y),{id:b.id}));else{this.unsubscribe(),this.state=j.errored,e?.(q.CHANNEL_ERROR,new Error("mismatch between server and client bindings for postgres changes"));return}}this.bindings.postgres_changes=p,e&&e(q.SUBSCRIBED);return}}).receive("error",d=>{this.state=j.errored,e?.(q.CHANNEL_ERROR,new Error(JSON.stringify(Object.values(d).join(", ")||"error")))}).receive("timeout",()=>{e?.(q.TIMED_OUT)})}return this}presenceState(){return this.presence.state}async track(e,t={}){return await this.send({type:"presence",event:"track",payload:e},t.timeout||this.timeout)}async untrack(e={}){return await this.send({type:"presence",event:"untrack"},e)}on(e,t,s){return this._on(e,t,s)}async send(e,t={}){var s,i;if(!this._canPush()&&e.type==="broadcast"){const{event:n,payload:a}=e,l={method:"POST",headers:{Authorization:this.socket.accessTokenValue?`Bearer ${this.socket.accessTokenValue}`:"",apikey:this.socket.apiKey?this.socket.apiKey:"","Content-Type":"application/json"},body:JSON.stringify({messages:[{topic:this.subTopic,event:n,payload:a,private:this.private}]})};try{const u=await this._fetchWithTimeout(this.broadcastEndpointURL,l,(s=t.timeout)!==null&&s!==void 0?s:this.timeout);return await((i=u.body)===null||i===void 0?void 0:i.cancel()),u.ok?"ok":"error"}catch(u){return u.name==="AbortError"?"timed out":"error"}}else return new Promise(n=>{var a,o,l;const u=this._push(e.type,e,t.timeout||this.timeout);e.type==="broadcast"&&!(!((l=(o=(a=this.params)===null||a===void 0?void 0:a.config)===null||o===void 0?void 0:o.broadcast)===null||l===void 0)&&l.ack)&&n("ok"),u.receive("ok",()=>n("ok")),u.receive("error",()=>n("error")),u.receive("timeout",()=>n("timed out"))})}updateJoinPayload(e){this.joinPush.updatePayload(e)}unsubscribe(e=this.timeout){this.state=j.leaving;const t=()=>{this.socket.log("channel",`leave ${this.topic}`),this._trigger(M.close,"leave",this._joinRef())};this.joinPush.destroy();let s=null;return new Promise(i=>{s=new ut(this,M.leave,{},e),s.receive("ok",()=>{t(),i("ok")}).receive("timeout",()=>{t(),i("timed out")}).receive("error",()=>{i("error")}),s.send(),this._canPush()||s.trigger("ok",{})}).finally(()=>{s?.destroy()})}teardown(){this.pushBuffer.forEach(e=>e.destroy()),this.rejoinTimer&&clearTimeout(this.rejoinTimer.timer),this.joinPush.destroy()}async _fetchWithTimeout(e,t,s){const i=new AbortController,n=setTimeout(()=>i.abort(),s),a=await this.socket.fetch(e,Object.assign(Object.assign({},t),{signal:i.signal}));return clearTimeout(n),a}_push(e,t,s=this.timeout){if(!this.joinedOnce)throw`tried to push '${e}' to '${this.topic}' before joining. Use channel.subscribe() before pushing events`;let i=new ut(this,e,t,s);return this._canPush()?i.send():(i.startTimeout(),this.pushBuffer.push(i)),i}_onMessage(e,t,s){return t}_isMember(e){return this.topic===e}_joinRef(){return this.joinPush.ref}_trigger(e,t,s){var i,n;const a=e.toLocaleLowerCase(),{close:o,error:l,leave:u,join:d}=M;if(s&&[o,l,u,d].indexOf(a)>=0&&s!==this._joinRef())return;let f=this._onMessage(a,t,s);if(t&&!f)throw"channel onMessage callbacks must return the payload, modified or unmodified";["insert","update","delete"].includes(a)?(i=this.bindings.postgres_changes)===null||i===void 0||i.filter(h=>{var p,m,y;return((p=h.filter)===null||p===void 0?void 0:p.event)==="*"||((y=(m=h.filter)===null||m===void 0?void 0:m.event)===null||y===void 0?void 0:y.toLocaleLowerCase())===a}).map(h=>h.callback(f,s)):(n=this.bindings[a])===null||n===void 0||n.filter(h=>{var p,m,y,S,v,_;if(["broadcast","presence","postgres_changes"].includes(a))if("id"in h){const g=h.id,b=(p=h.filter)===null||p===void 0?void 0:p.event;return g&&((m=t.ids)===null||m===void 0?void 0:m.includes(g))&&(b==="*"||b?.toLocaleLowerCase()===((y=t.data)===null||y===void 0?void 0:y.type.toLocaleLowerCase()))}else{const g=(v=(S=h?.filter)===null||S===void 0?void 0:S.event)===null||v===void 0?void 0:v.toLocaleLowerCase();return g==="*"||g===((_=t?.event)===null||_===void 0?void 0:_.toLocaleLowerCase())}else return h.type.toLocaleLowerCase()===a}).map(h=>{if(typeof f=="object"&&"ids"in f){const p=f.data,{schema:m,table:y,commit_timestamp:S,type:v,errors:_}=p;f=Object.assign(Object.assign({},{schema:m,table:y,commit_timestamp:S,eventType:v,new:{},old:{},errors:_}),this._getPayloadRecords(p))}h.callback(f,s)})}_isClosed(){return this.state===j.closed}_isJoined(){return this.state===j.joined}_isJoining(){return this.state===j.joining}_isLeaving(){return this.state===j.leaving}_replyEventName(e){return`chan_reply_${e}`}_on(e,t,s){const i=e.toLocaleLowerCase(),n={type:i,filter:t,callback:s};return this.bindings[i]?this.bindings[i].push(n):this.bindings[i]=[n],this}_off(e,t){const s=e.toLocaleLowerCase();return this.bindings[s]=this.bindings[s].filter(i=>{var n;return!(((n=i.type)===null||n===void 0?void 0:n.toLocaleLowerCase())===s&&Mt.isEqual(i.filter,t))}),this}static isEqual(e,t){if(Object.keys(e).length!==Object.keys(t).length)return!1;for(const s in e)if(e[s]!==t[s])return!1;return!0}_rejoinUntilConnected(){this.rejoinTimer.scheduleTimeout(),this.socket.isConnected()&&this._rejoin()}_onClose(e){this._on(M.close,{},e)}_onError(e){this._on(M.error,{},t=>e(t))}_canPush(){return this.socket.isConnected()&&this._isJoined()}_rejoin(e=this.timeout){this._isLeaving()||(this.socket._leaveOpenTopic(this.topic),this.state=j.joining,this.joinPush.resend(e))}_getPayloadRecords(e){const t={new:{},old:{}};return(e.type==="INSERT"||e.type==="UPDATE")&&(t.new=Cs(e.columns,e.record)),(e.type==="UPDATE"||e.type==="DELETE")&&(t.old=Cs(e.columns,e.old_record)),t}}const Ds=()=>{},en=`
  addEventListener("message", (e) => {
    if (e.data.event === "start") {
      setInterval(() => postMessage({ event: "keepAlive" }), e.data.interval);
    }
  });`;class tn{constructor(e,t){var s;this.accessTokenValue=null,this.apiKey=null,this.channels=new Array,this.endPoint="",this.httpEndpoint="",this.headers={},this.params={},this.timeout=yr,this.heartbeatIntervalMs=25e3,this.heartbeatTimer=void 0,this.pendingHeartbeatRef=null,this.heartbeatCallback=Ds,this.ref=0,this.logger=Ds,this.conn=null,this.sendBuffer=[],this.serializer=new Ji,this.stateChangeCallbacks={open:[],close:[],error:[],message:[]},this.accessToken=null,this._resolveFetch=n=>{let a;return n?a=n:typeof fetch>"u"?a=(...o)=>Ge(async()=>{const{default:l}=await Promise.resolve().then(()=>be);return{default:l}},void 0).then(({default:l})=>l(...o)):a=fetch,(...o)=>a(...o)},this.endPoint=`${e}/${mt.websocket}`,this.httpEndpoint=br(e),t?.transport?this.transport=t.transport:this.transport=null,t?.params&&(this.params=t.params),t?.timeout&&(this.timeout=t.timeout),t?.logger&&(this.logger=t.logger),(t?.logLevel||t?.log_level)&&(this.logLevel=t.logLevel||t.log_level,this.params=Object.assign(Object.assign({},this.params),{log_level:this.logLevel})),t?.heartbeatIntervalMs&&(this.heartbeatIntervalMs=t.heartbeatIntervalMs);const i=(s=t?.params)===null||s===void 0?void 0:s.apikey;if(i&&(this.accessTokenValue=i,this.apiKey=i),this.reconnectAfterMs=t?.reconnectAfterMs?t.reconnectAfterMs:n=>[1e3,2e3,5e3,1e4][n-1]||1e4,this.encode=t?.encode?t.encode:(n,a)=>a(JSON.stringify(n)),this.decode=t?.decode?t.decode:this.serializer.decode.bind(this.serializer),this.reconnectTimer=new mr(async()=>{this.disconnect(),this.connect()},this.reconnectAfterMs),this.fetch=this._resolveFetch(t?.fetch),t?.worker){if(typeof window<"u"&&!window.Worker)throw new Error("Web Worker is not supported");this.worker=t?.worker||!1,this.workerUrl=t?.workerUrl}this.accessToken=t?.accessToken||null}connect(){if(!this.conn){if(this.transport||(this.transport=qi),!this.transport)throw new Error("No transport provided");this.conn=new this.transport(this.endpointURL()),this.setupConnection()}}endpointURL(){return this._appendParams(this.endPoint,Object.assign({},this.params,{vsn:Hi}))}disconnect(e,t){this.conn&&(this.conn.onclose=function(){},e?this.conn.close(e,t??""):this.conn.close(),this.conn=null,this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.reset(),this.channels.forEach(s=>s.teardown()))}getChannels(){return this.channels}async removeChannel(e){const t=await e.unsubscribe();return this.channels.length===0&&this.disconnect(),t}async removeAllChannels(){const e=await Promise.all(this.channels.map(t=>t.unsubscribe()));return this.channels=[],this.disconnect(),e}log(e,t,s){this.logger(e,t,s)}connectionState(){switch(this.conn&&this.conn.readyState){case Be.connecting:return te.Connecting;case Be.open:return te.Open;case Be.closing:return te.Closing;default:return te.Closed}}isConnected(){return this.connectionState()===te.Open}channel(e,t={config:{}}){const s=`realtime:${e}`,i=this.getChannels().find(n=>n.topic===s);if(i)return i;{const n=new Mt(`realtime:${e}`,t,this);return this.channels.push(n),n}}push(e){const{topic:t,event:s,payload:i,ref:n}=e,a=()=>{this.encode(e,o=>{var l;(l=this.conn)===null||l===void 0||l.send(o)})};this.log("push",`${t} ${s} (${n})`,i),this.isConnected()?a():this.sendBuffer.push(a)}async setAuth(e=null){let t=e||this.accessToken&&await this.accessToken()||this.accessTokenValue;this.accessTokenValue!=t&&(this.accessTokenValue=t,this.channels.forEach(s=>{const i={access_token:t,version:zi};t&&s.updateJoinPayload(i),s.joinedOnce&&s._isJoined()&&s._push(M.access_token,{access_token:t})}))}async sendHeartbeat(){var e;if(!this.isConnected()){this.heartbeatCallback("disconnected");return}if(this.pendingHeartbeatRef){this.pendingHeartbeatRef=null,this.log("transport","heartbeat timeout. Attempting to re-establish connection"),this.heartbeatCallback("timeout"),(e=this.conn)===null||e===void 0||e.close(Gi,"hearbeat timeout");return}this.pendingHeartbeatRef=this._makeRef(),this.push({topic:"phoenix",event:"heartbeat",payload:{},ref:this.pendingHeartbeatRef}),this.heartbeatCallback("sent"),await this.setAuth()}onHeartbeat(e){this.heartbeatCallback=e}flushSendBuffer(){this.isConnected()&&this.sendBuffer.length>0&&(this.sendBuffer.forEach(e=>e()),this.sendBuffer=[])}_makeRef(){let e=this.ref+1;return e===this.ref?this.ref=0:this.ref=e,this.ref.toString()}_leaveOpenTopic(e){let t=this.channels.find(s=>s.topic===e&&(s._isJoined()||s._isJoining()));t&&(this.log("transport",`leaving duplicate topic "${e}"`),t.unsubscribe())}_remove(e){this.channels=this.channels.filter(t=>t.topic!==e.topic)}setupConnection(){this.conn&&(this.conn.binaryType="arraybuffer",this.conn.onopen=()=>this._onConnOpen(),this.conn.onerror=e=>this._onConnError(e),this.conn.onmessage=e=>this._onConnMessage(e),this.conn.onclose=e=>this._onConnClose(e))}_onConnMessage(e){this.decode(e.data,t=>{let{topic:s,event:i,payload:n,ref:a}=t;s==="phoenix"&&i==="phx_reply"&&this.heartbeatCallback(t.payload.status=="ok"?"ok":"error"),a&&a===this.pendingHeartbeatRef&&(this.pendingHeartbeatRef=null),this.log("receive",`${n.status||""} ${s} ${i} ${a&&"("+a+")"||""}`,n),Array.from(this.channels).filter(o=>o._isMember(s)).forEach(o=>o._trigger(i,n,a)),this.stateChangeCallbacks.message.forEach(o=>o(t))})}_onConnOpen(){this.log("transport",`connected to ${this.endpointURL()}`),this.flushSendBuffer(),this.reconnectTimer.reset(),this.worker?this.workerRef||this._startWorkerHeartbeat():this._startHeartbeat(),this.stateChangeCallbacks.open.forEach(e=>e())}_startHeartbeat(){this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.heartbeatTimer=setInterval(()=>this.sendHeartbeat(),this.heartbeatIntervalMs)}_startWorkerHeartbeat(){this.workerUrl?this.log("worker",`starting worker for from ${this.workerUrl}`):this.log("worker","starting default worker");const e=this._workerObjectUrl(this.workerUrl);this.workerRef=new Worker(e),this.workerRef.onerror=t=>{this.log("worker","worker error",t.message),this.workerRef.terminate()},this.workerRef.onmessage=t=>{t.data.event==="keepAlive"&&this.sendHeartbeat()},this.workerRef.postMessage({event:"start",interval:this.heartbeatIntervalMs})}_onConnClose(e){this.log("transport","close",e),this._triggerChanError(),this.heartbeatTimer&&clearInterval(this.heartbeatTimer),this.reconnectTimer.scheduleTimeout(),this.stateChangeCallbacks.close.forEach(t=>t(e))}_onConnError(e){this.log("transport",`${e}`),this._triggerChanError(),this.stateChangeCallbacks.error.forEach(t=>t(e))}_triggerChanError(){this.channels.forEach(e=>e._trigger(M.error))}_appendParams(e,t){if(Object.keys(t).length===0)return e;const s=e.match(/\?/)?"&":"?",i=new URLSearchParams(t);return`${e}${s}${i}`}_workerObjectUrl(e){let t;if(e)t=e;else{const s=new Blob([en],{type:"application/javascript"});t=URL.createObjectURL(s)}return t}}class Ft extends Error{constructor(e){super(e),this.__isStorageError=!0,this.name="StorageError"}}function $(r){return typeof r=="object"&&r!==null&&"__isStorageError"in r}class sn extends Ft{constructor(e,t){super(e),this.name="StorageApiError",this.status=t}toJSON(){return{name:this.name,message:this.message,status:this.status}}}class bt extends Ft{constructor(e,t){super(e),this.name="StorageUnknownError",this.originalError=t}}var rn=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};const kr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ge(async()=>{const{default:s}=await Promise.resolve().then(()=>be);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},nn=()=>rn(void 0,void 0,void 0,function*(){return typeof Response>"u"?(yield Ge(()=>Promise.resolve().then(()=>be),void 0)).Response:Response}),kt=r=>{if(Array.isArray(r))return r.map(t=>kt(t));if(typeof r=="function"||r!==Object(r))return r;const e={};return Object.entries(r).forEach(([t,s])=>{const i=t.replace(/([-_][a-z])/gi,n=>n.toUpperCase().replace(/[-_]/g,""));e[i]=kt(s)}),e};var ie=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};const dt=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),an=(r,e,t)=>ie(void 0,void 0,void 0,function*(){const s=yield nn();r instanceof s&&!t?.noResolveJson?r.json().then(i=>{e(new sn(dt(i),r.status||500))}).catch(i=>{e(new bt(dt(i),i))}):e(new bt(dt(r),r))}),on=(r,e,t,s)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json"},e?.headers),s&&(i.body=JSON.stringify(s)),Object.assign(Object.assign({},i),t))};function Je(r,e,t,s,i,n){return ie(this,void 0,void 0,function*(){return new Promise((a,o)=>{r(t,on(e,s,i,n)).then(l=>{if(!l.ok)throw l;return s?.noResolveJson?l:l.json()}).then(l=>a(l)).catch(l=>an(l,o,s))})})}function it(r,e,t,s){return ie(this,void 0,void 0,function*(){return Je(r,"GET",e,t,s)})}function K(r,e,t,s,i){return ie(this,void 0,void 0,function*(){return Je(r,"POST",e,s,i,t)})}function cn(r,e,t,s,i){return ie(this,void 0,void 0,function*(){return Je(r,"PUT",e,s,i,t)})}function ln(r,e,t,s){return ie(this,void 0,void 0,function*(){return Je(r,"HEAD",e,Object.assign(Object.assign({},t),{noResolveJson:!0}),s)})}function Sr(r,e,t,s,i){return ie(this,void 0,void 0,function*(){return Je(r,"DELETE",e,s,i,t)})}var I=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};const un={limit:100,offset:0,sortBy:{column:"name",order:"asc"}},Ls={cacheControl:"3600",contentType:"text/plain;charset=UTF-8",upsert:!1};class dn{constructor(e,t={},s,i){this.url=e,this.headers=t,this.bucketId=s,this.fetch=kr(i)}uploadOrUpdate(e,t,s,i){return I(this,void 0,void 0,function*(){try{let n;const a=Object.assign(Object.assign({},Ls),i);let o=Object.assign(Object.assign({},this.headers),e==="POST"&&{"x-upsert":String(a.upsert)});const l=a.metadata;typeof Blob<"u"&&s instanceof Blob?(n=new FormData,n.append("cacheControl",a.cacheControl),l&&n.append("metadata",this.encodeMetadata(l)),n.append("",s)):typeof FormData<"u"&&s instanceof FormData?(n=s,n.append("cacheControl",a.cacheControl),l&&n.append("metadata",this.encodeMetadata(l))):(n=s,o["cache-control"]=`max-age=${a.cacheControl}`,o["content-type"]=a.contentType,l&&(o["x-metadata"]=this.toBase64(this.encodeMetadata(l)))),i?.headers&&(o=Object.assign(Object.assign({},o),i.headers));const u=this._removeEmptyFolders(t),d=this._getFinalPath(u),c=yield this.fetch(`${this.url}/object/${d}`,Object.assign({method:e,body:n,headers:o},a?.duplex?{duplex:a.duplex}:{})),f=yield c.json();return c.ok?{data:{path:u,id:f.Id,fullPath:f.Key},error:null}:{data:null,error:f}}catch(n){if($(n))return{data:null,error:n};throw n}})}upload(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("POST",e,t,s)})}uploadToSignedUrl(e,t,s,i){return I(this,void 0,void 0,function*(){const n=this._removeEmptyFolders(e),a=this._getFinalPath(n),o=new URL(this.url+`/object/upload/sign/${a}`);o.searchParams.set("token",t);try{let l;const u=Object.assign({upsert:Ls.upsert},i),d=Object.assign(Object.assign({},this.headers),{"x-upsert":String(u.upsert)});typeof Blob<"u"&&s instanceof Blob?(l=new FormData,l.append("cacheControl",u.cacheControl),l.append("",s)):typeof FormData<"u"&&s instanceof FormData?(l=s,l.append("cacheControl",u.cacheControl)):(l=s,d["cache-control"]=`max-age=${u.cacheControl}`,d["content-type"]=u.contentType);const c=yield this.fetch(o.toString(),{method:"PUT",body:l,headers:d}),f=yield c.json();return c.ok?{data:{path:n,fullPath:f.Key},error:null}:{data:null,error:f}}catch(l){if($(l))return{data:null,error:l};throw l}})}createSignedUploadUrl(e,t){return I(this,void 0,void 0,function*(){try{let s=this._getFinalPath(e);const i=Object.assign({},this.headers);t?.upsert&&(i["x-upsert"]="true");const n=yield K(this.fetch,`${this.url}/object/upload/sign/${s}`,{},{headers:i}),a=new URL(this.url+n.url),o=a.searchParams.get("token");if(!o)throw new Ft("No token returned by API");return{data:{signedUrl:a.toString(),path:e,token:o},error:null}}catch(s){if($(s))return{data:null,error:s};throw s}})}update(e,t,s){return I(this,void 0,void 0,function*(){return this.uploadOrUpdate("PUT",e,t,s)})}move(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:yield K(this.fetch,`${this.url}/object/move`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers}),error:null}}catch(i){if($(i))return{data:null,error:i};throw i}})}copy(e,t,s){return I(this,void 0,void 0,function*(){try{return{data:{path:(yield K(this.fetch,`${this.url}/object/copy`,{bucketId:this.bucketId,sourceKey:e,destinationKey:t,destinationBucket:s?.destinationBucket},{headers:this.headers})).Key},error:null}}catch(i){if($(i))return{data:null,error:i};throw i}})}createSignedUrl(e,t,s){return I(this,void 0,void 0,function*(){try{let i=this._getFinalPath(e),n=yield K(this.fetch,`${this.url}/object/sign/${i}`,Object.assign({expiresIn:t},s?.transform?{transform:s.transform}:{}),{headers:this.headers});const a=s?.download?`&download=${s.download===!0?"":s.download}`:"";return n={signedUrl:encodeURI(`${this.url}${n.signedURL}${a}`)},{data:n,error:null}}catch(i){if($(i))return{data:null,error:i};throw i}})}createSignedUrls(e,t,s){return I(this,void 0,void 0,function*(){try{const i=yield K(this.fetch,`${this.url}/object/sign/${this.bucketId}`,{expiresIn:t,paths:e},{headers:this.headers}),n=s?.download?`&download=${s.download===!0?"":s.download}`:"";return{data:i.map(a=>Object.assign(Object.assign({},a),{signedUrl:a.signedURL?encodeURI(`${this.url}${a.signedURL}${n}`):null})),error:null}}catch(i){if($(i))return{data:null,error:i};throw i}})}download(e,t){return I(this,void 0,void 0,function*(){const i=typeof t?.transform<"u"?"render/image/authenticated":"object",n=this.transformOptsToQueryString(t?.transform||{}),a=n?`?${n}`:"";try{const o=this._getFinalPath(e);return{data:yield(yield it(this.fetch,`${this.url}/${i}/${o}${a}`,{headers:this.headers,noResolveJson:!0})).blob(),error:null}}catch(o){if($(o))return{data:null,error:o};throw o}})}info(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{const s=yield it(this.fetch,`${this.url}/object/info/${t}`,{headers:this.headers});return{data:kt(s),error:null}}catch(s){if($(s))return{data:null,error:s};throw s}})}exists(e){return I(this,void 0,void 0,function*(){const t=this._getFinalPath(e);try{return yield ln(this.fetch,`${this.url}/object/${t}`,{headers:this.headers}),{data:!0,error:null}}catch(s){if($(s)&&s instanceof bt){const i=s.originalError;if([400,404].includes(i?.status))return{data:!1,error:s}}throw s}})}getPublicUrl(e,t){const s=this._getFinalPath(e),i=[],n=t?.download?`download=${t.download===!0?"":t.download}`:"";n!==""&&i.push(n);const o=typeof t?.transform<"u"?"render/image":"object",l=this.transformOptsToQueryString(t?.transform||{});l!==""&&i.push(l);let u=i.join("&");return u!==""&&(u=`?${u}`),{data:{publicUrl:encodeURI(`${this.url}/${o}/public/${s}${u}`)}}}remove(e){return I(this,void 0,void 0,function*(){try{return{data:yield Sr(this.fetch,`${this.url}/object/${this.bucketId}`,{prefixes:e},{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}list(e,t,s){return I(this,void 0,void 0,function*(){try{const i=Object.assign(Object.assign(Object.assign({},un),t),{prefix:e||""});return{data:yield K(this.fetch,`${this.url}/object/list/${this.bucketId}`,i,{headers:this.headers},s),error:null}}catch(i){if($(i))return{data:null,error:i};throw i}})}encodeMetadata(e){return JSON.stringify(e)}toBase64(e){return typeof Buffer<"u"?Buffer.from(e).toString("base64"):btoa(e)}_getFinalPath(e){return`${this.bucketId}/${e}`}_removeEmptyFolders(e){return e.replace(/^\/|\/$/g,"").replace(/\/+/g,"/")}transformOptsToQueryString(e){const t=[];return e.width&&t.push(`width=${e.width}`),e.height&&t.push(`height=${e.height}`),e.resize&&t.push(`resize=${e.resize}`),e.format&&t.push(`format=${e.format}`),e.quality&&t.push(`quality=${e.quality}`),t.join("&")}}const hn="2.7.1",fn={"X-Client-Info":`storage-js/${hn}`};var ue=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};class gn{constructor(e,t={},s){this.url=e,this.headers=Object.assign(Object.assign({},fn),t),this.fetch=kr(s)}listBuckets(){return ue(this,void 0,void 0,function*(){try{return{data:yield it(this.fetch,`${this.url}/bucket`,{headers:this.headers}),error:null}}catch(e){if($(e))return{data:null,error:e};throw e}})}getBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield it(this.fetch,`${this.url}/bucket/${e}`,{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}createBucket(e,t={public:!1}){return ue(this,void 0,void 0,function*(){try{return{data:yield K(this.fetch,`${this.url}/bucket`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if($(s))return{data:null,error:s};throw s}})}updateBucket(e,t){return ue(this,void 0,void 0,function*(){try{return{data:yield cn(this.fetch,`${this.url}/bucket/${e}`,{id:e,name:e,public:t.public,file_size_limit:t.fileSizeLimit,allowed_mime_types:t.allowedMimeTypes},{headers:this.headers}),error:null}}catch(s){if($(s))return{data:null,error:s};throw s}})}emptyBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield K(this.fetch,`${this.url}/bucket/${e}/empty`,{},{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}deleteBucket(e){return ue(this,void 0,void 0,function*(){try{return{data:yield Sr(this.fetch,`${this.url}/bucket/${e}`,{},{headers:this.headers}),error:null}}catch(t){if($(t))return{data:null,error:t};throw t}})}}class pn extends gn{constructor(e,t={},s){super(e,t,s)}from(e){return new dn(this.url,this.headers,e,this.fetch)}}const vn="2.52.1";let Ie="";typeof Deno<"u"?Ie="deno":typeof document<"u"?Ie="web":typeof navigator<"u"&&navigator.product==="ReactNative"?Ie="react-native":Ie="node";const _n={"X-Client-Info":`supabase-js-${Ie}/${vn}`},yn={headers:_n},mn={schema:"public"},wn={autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,flowType:"implicit"},bn={};var kn=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};const Sn=r=>{let e;return r?e=r:typeof fetch>"u"?e=hr:e=fetch,(...t)=>e(...t)},Pn=()=>typeof Headers>"u"?fr:Headers,En=(r,e,t)=>{const s=Sn(t),i=Pn();return(n,a)=>kn(void 0,void 0,void 0,function*(){var o;const l=(o=yield e())!==null&&o!==void 0?o:r;let u=new i(a?.headers);return u.has("apikey")||u.set("apikey",r),u.has("Authorization")||u.set("Authorization",`Bearer ${l}`),s(n,Object.assign(Object.assign({},a),{headers:u}))})};var On=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};function $n(r){return r.endsWith("/")?r:r+"/"}function Tn(r,e){var t,s;const{db:i,auth:n,realtime:a,global:o}=r,{db:l,auth:u,realtime:d,global:c}=e,f={db:Object.assign(Object.assign({},l),i),auth:Object.assign(Object.assign({},u),n),realtime:Object.assign(Object.assign({},d),a),global:Object.assign(Object.assign(Object.assign({},c),o),{headers:Object.assign(Object.assign({},(t=c?.headers)!==null&&t!==void 0?t:{}),(s=o?.headers)!==null&&s!==void 0?s:{})}),accessToken:()=>On(this,void 0,void 0,function*(){return""})};return r.accessToken?f.accessToken=r.accessToken:delete f.accessToken,f}const Pr="2.71.1",pe=30*1e3,St=3,ht=St*pe,xn="http://localhost:9999",jn="supabase.auth.token",Cn={"X-Client-Info":`gotrue-js/${Pr}`},Pt="X-Supabase-Api-Version",Er={"2024-01-01":{timestamp:Date.parse("2024-01-01T00:00:00.0Z"),name:"2024-01-01"}},In=/^([a-z0-9_-]{4})*($|[a-z0-9_-]{3}$|[a-z0-9_-]{2}$)$/i,An=10*60*1e3;class Bt extends Error{constructor(e,t,s){super(e),this.__isAuthError=!0,this.name="AuthError",this.status=t,this.code=s}}function w(r){return typeof r=="object"&&r!==null&&"__isAuthError"in r}class Rn extends Bt{constructor(e,t,s){super(e,t,s),this.name="AuthApiError",this.status=t,this.code=s}}function Dn(r){return w(r)&&r.name==="AuthApiError"}class Or extends Bt{constructor(e,t){super(e),this.name="AuthUnknownError",this.originalError=t}}class X extends Bt{constructor(e,t,s,i){super(e,s,i),this.name=t,this.status=s}}class J extends X{constructor(){super("Auth session missing!","AuthSessionMissingError",400,void 0)}}function Ln(r){return w(r)&&r.name==="AuthSessionMissingError"}class et extends X{constructor(){super("Auth session or user missing","AuthInvalidTokenResponseError",500,void 0)}}class tt extends X{constructor(e){super(e,"AuthInvalidCredentialsError",400,void 0)}}class st extends X{constructor(e,t=null){super(e,"AuthImplicitGrantRedirectError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}function Un(r){return w(r)&&r.name==="AuthImplicitGrantRedirectError"}class Us extends X{constructor(e,t=null){super(e,"AuthPKCEGrantCodeExchangeError",500,void 0),this.details=null,this.details=t}toJSON(){return{name:this.name,message:this.message,status:this.status,details:this.details}}}class Et extends X{constructor(e,t){super(e,"AuthRetryableFetchError",t,void 0)}}function ft(r){return w(r)&&r.name==="AuthRetryableFetchError"}class Ms extends X{constructor(e,t,s){super(e,"AuthWeakPasswordError",t,"weak_password"),this.reasons=s}}class Ot extends X{constructor(e){super(e,"AuthInvalidJwtError",400,"invalid_jwt")}}const nt="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_".split(""),Fs=` 	
\r=`.split(""),Mn=(()=>{const r=new Array(128);for(let e=0;e<r.length;e+=1)r[e]=-1;for(let e=0;e<Fs.length;e+=1)r[Fs[e].charCodeAt(0)]=-2;for(let e=0;e<nt.length;e+=1)r[nt[e].charCodeAt(0)]=e;return r})();function Bs(r,e,t){if(r!==null)for(e.queue=e.queue<<8|r,e.queuedBits+=8;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(nt[s]),e.queuedBits-=6}else if(e.queuedBits>0)for(e.queue=e.queue<<6-e.queuedBits,e.queuedBits=6;e.queuedBits>=6;){const s=e.queue>>e.queuedBits-6&63;t(nt[s]),e.queuedBits-=6}}function $r(r,e,t){const s=Mn[r];if(s>-1)for(e.queue=e.queue<<6|s,e.queuedBits+=6;e.queuedBits>=8;)t(e.queue>>e.queuedBits-8&255),e.queuedBits-=8;else{if(s===-2)return;throw new Error(`Invalid Base64-URL character "${String.fromCharCode(r)}"`)}}function Ns(r){const e=[],t=a=>{e.push(String.fromCodePoint(a))},s={utf8seq:0,codepoint:0},i={queue:0,queuedBits:0},n=a=>{Nn(a,s,t)};for(let a=0;a<r.length;a+=1)$r(r.charCodeAt(a),i,n);return e.join("")}function Fn(r,e){if(r<=127){e(r);return}else if(r<=2047){e(192|r>>6),e(128|r&63);return}else if(r<=65535){e(224|r>>12),e(128|r>>6&63),e(128|r&63);return}else if(r<=1114111){e(240|r>>18),e(128|r>>12&63),e(128|r>>6&63),e(128|r&63);return}throw new Error(`Unrecognized Unicode codepoint: ${r.toString(16)}`)}function Bn(r,e){for(let t=0;t<r.length;t+=1){let s=r.charCodeAt(t);if(s>55295&&s<=56319){const i=(s-55296)*1024&65535;s=(r.charCodeAt(t+1)-56320&65535|i)+65536,t+=1}Fn(s,e)}}function Nn(r,e,t){if(e.utf8seq===0){if(r<=127){t(r);return}for(let s=1;s<6;s+=1)if((r>>7-s&1)===0){e.utf8seq=s;break}if(e.utf8seq===2)e.codepoint=r&31;else if(e.utf8seq===3)e.codepoint=r&15;else if(e.utf8seq===4)e.codepoint=r&7;else throw new Error("Invalid UTF-8 sequence");e.utf8seq-=1}else if(e.utf8seq>0){if(r<=127)throw new Error("Invalid UTF-8 sequence");e.codepoint=e.codepoint<<6|r&63,e.utf8seq-=1,e.utf8seq===0&&t(e.codepoint)}}function qn(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};for(let i=0;i<r.length;i+=1)$r(r.charCodeAt(i),t,s);return new Uint8Array(e)}function Wn(r){const e=[];return Bn(r,t=>e.push(t)),new Uint8Array(e)}function zn(r){const e=[],t={queue:0,queuedBits:0},s=i=>{e.push(i)};return r.forEach(i=>Bs(i,t,s)),Bs(null,t,s),e.join("")}function Hn(r){return Math.round(Date.now()/1e3)+r}function Gn(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,function(r){const e=Math.random()*16|0;return(r=="x"?e:e&3|8).toString(16)})}const L=()=>typeof window<"u"&&typeof document<"u",Y={tested:!1,writable:!1},Tr=()=>{if(!L())return!1;try{if(typeof globalThis.localStorage!="object")return!1}catch{return!1}if(Y.tested)return Y.writable;const r=`lswt-${Math.random()}${Math.random()}`;try{globalThis.localStorage.setItem(r,r),globalThis.localStorage.removeItem(r),Y.tested=!0,Y.writable=!0}catch{Y.tested=!0,Y.writable=!1}return Y.writable};function Jn(r){const e={},t=new URL(r);if(t.hash&&t.hash[0]==="#")try{new URLSearchParams(t.hash.substring(1)).forEach((i,n)=>{e[n]=i})}catch{}return t.searchParams.forEach((s,i)=>{e[i]=s}),e}const xr=r=>{let e;return r?e=r:typeof fetch>"u"?e=(...t)=>Ge(async()=>{const{default:s}=await Promise.resolve().then(()=>be);return{default:s}},void 0).then(({default:s})=>s(...t)):e=fetch,(...t)=>e(...t)},Kn=r=>typeof r=="object"&&r!==null&&"status"in r&&"ok"in r&&"json"in r&&typeof r.json=="function",ve=async(r,e,t)=>{await r.setItem(e,JSON.stringify(t))},Z=async(r,e)=>{const t=await r.getItem(e);if(!t)return null;try{return JSON.parse(t)}catch{return t}},G=async(r,e)=>{await r.removeItem(e)};class ct{constructor(){this.promise=new ct.promiseConstructor((e,t)=>{this.resolve=e,this.reject=t})}}ct.promiseConstructor=Promise;function gt(r){const e=r.split(".");if(e.length!==3)throw new Ot("Invalid JWT structure");for(let s=0;s<e.length;s++)if(!In.test(e[s]))throw new Ot("JWT not in base64url format");return{header:JSON.parse(Ns(e[0])),payload:JSON.parse(Ns(e[1])),signature:qn(e[2]),raw:{header:e[0],payload:e[1]}}}async function Vn(r){return await new Promise(e=>{setTimeout(()=>e(null),r)})}function Qn(r,e){return new Promise((s,i)=>{(async()=>{for(let n=0;n<1/0;n++)try{const a=await r(n);if(!e(n,null,a)){s(a);return}}catch(a){if(!e(n,a)){i(a);return}}})()})}function Xn(r){return("0"+r.toString(16)).substr(-2)}function Yn(){const e=new Uint32Array(56);if(typeof crypto>"u"){const t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-._~",s=t.length;let i="";for(let n=0;n<56;n++)i+=t.charAt(Math.floor(Math.random()*s));return i}return crypto.getRandomValues(e),Array.from(e,Xn).join("")}async function Zn(r){const t=new TextEncoder().encode(r),s=await crypto.subtle.digest("SHA-256",t),i=new Uint8Array(s);return Array.from(i).map(n=>String.fromCharCode(n)).join("")}async function ea(r){if(!(typeof crypto<"u"&&typeof crypto.subtle<"u"&&typeof TextEncoder<"u"))return console.warn("WebCrypto API is not supported. Code challenge method will default to use plain instead of sha256."),r;const t=await Zn(r);return btoa(t).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}async function de(r,e,t=!1){const s=Yn();let i=s;t&&(i+="/PASSWORD_RECOVERY"),await ve(r,`${e}-code-verifier`,i);const n=await ea(s);return[n,s===n?"plain":"s256"]}const ta=/^2[0-9]{3}-(0[1-9]|1[0-2])-(0[1-9]|1[0-9]|2[0-9]|3[0-1])$/i;function sa(r){const e=r.headers.get(Pt);if(!e||!e.match(ta))return null;try{return new Date(`${e}T00:00:00.0Z`)}catch{return null}}function ra(r){if(!r)throw new Error("Missing exp claim");const e=Math.floor(Date.now()/1e3);if(r<=e)throw new Error("JWT has expired")}function ia(r){switch(r){case"RS256":return{name:"RSASSA-PKCS1-v1_5",hash:{name:"SHA-256"}};case"ES256":return{name:"ECDSA",namedCurve:"P-256",hash:{name:"SHA-256"}};default:throw new Error("Invalid alg claim")}}const na=/^[0-9a-f]{8}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{4}-[0-9a-f]{12}$/;function he(r){if(!na.test(r))throw new Error("@supabase/auth-js: Expected parameter to be UUID but is not")}function pt(){const r={};return new Proxy(r,{get:(e,t)=>{if(t==="__isUserNotAvailableProxy")return!0;if(typeof t=="symbol"){const s=t.toString();if(s==="Symbol(Symbol.toPrimitive)"||s==="Symbol(Symbol.toStringTag)"||s==="Symbol(util.inspect.custom)")return}throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Accessing the "${t}" property of the session object is not supported. Please use getUser() instead.`)},set:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Setting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)},deleteProperty:(e,t)=>{throw new Error(`@supabase/auth-js: client was created with userStorage option and there was no user stored in the user storage. Deleting the "${t}" property of the session object is not supported. Please use getUser() to fetch a user object you can manipulate.`)}})}function qs(r){return JSON.parse(JSON.stringify(r))}var aa=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};const ee=r=>r.msg||r.message||r.error_description||r.error||JSON.stringify(r),oa=[502,503,504];async function Ws(r){var e;if(!Kn(r))throw new Et(ee(r),0);if(oa.includes(r.status))throw new Et(ee(r),r.status);let t;try{t=await r.json()}catch(n){throw new Or(ee(n),n)}let s;const i=sa(r);if(i&&i.getTime()>=Er["2024-01-01"].timestamp&&typeof t=="object"&&t&&typeof t.code=="string"?s=t.code:typeof t=="object"&&t&&typeof t.error_code=="string"&&(s=t.error_code),s){if(s==="weak_password")throw new Ms(ee(t),r.status,((e=t.weak_password)===null||e===void 0?void 0:e.reasons)||[]);if(s==="session_not_found")throw new J}else if(typeof t=="object"&&t&&typeof t.weak_password=="object"&&t.weak_password&&Array.isArray(t.weak_password.reasons)&&t.weak_password.reasons.length&&t.weak_password.reasons.reduce((n,a)=>n&&typeof a=="string",!0))throw new Ms(ee(t),r.status,t.weak_password.reasons);throw new Rn(ee(t),r.status||500,s)}const ca=(r,e,t,s)=>{const i={method:r,headers:e?.headers||{}};return r==="GET"?i:(i.headers=Object.assign({"Content-Type":"application/json;charset=UTF-8"},e?.headers),i.body=JSON.stringify(s),Object.assign(Object.assign({},i),t))};async function k(r,e,t,s){var i;const n=Object.assign({},s?.headers);n[Pt]||(n[Pt]=Er["2024-01-01"].name),s?.jwt&&(n.Authorization=`Bearer ${s.jwt}`);const a=(i=s?.query)!==null&&i!==void 0?i:{};s?.redirectTo&&(a.redirect_to=s.redirectTo);const o=Object.keys(a).length?"?"+new URLSearchParams(a).toString():"",l=await la(r,e,t+o,{headers:n,noResolveJson:s?.noResolveJson},{},s?.body);return s?.xform?s?.xform(l):{data:Object.assign({},l),error:null}}async function la(r,e,t,s,i,n){const a=ca(e,s,i,n);let o;try{o=await r(t,Object.assign({},a))}catch(l){throw console.error(l),new Et(ee(l),0)}if(o.ok||await Ws(o),s?.noResolveJson)return o;try{return await o.json()}catch(l){await Ws(l)}}function B(r){var e;let t=null;fa(r)&&(t=Object.assign({},r),r.expires_at||(t.expires_at=Hn(r.expires_in)));const s=(e=r.user)!==null&&e!==void 0?e:r;return{data:{session:t,user:s},error:null}}function zs(r){const e=B(r);return!e.error&&r.weak_password&&typeof r.weak_password=="object"&&Array.isArray(r.weak_password.reasons)&&r.weak_password.reasons.length&&r.weak_password.message&&typeof r.weak_password.message=="string"&&r.weak_password.reasons.reduce((t,s)=>t&&typeof s=="string",!0)&&(e.data.weak_password=r.weak_password),e}function V(r){var e;return{data:{user:(e=r.user)!==null&&e!==void 0?e:r},error:null}}function ua(r){return{data:r,error:null}}function da(r){const{action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n}=r,a=aa(r,["action_link","email_otp","hashed_token","redirect_to","verification_type"]),o={action_link:e,email_otp:t,hashed_token:s,redirect_to:i,verification_type:n},l=Object.assign({},a);return{data:{properties:o,user:l},error:null}}function ha(r){return r}function fa(r){return r.access_token&&r.refresh_token&&r.expires_in}const vt=["global","local","others"];var ga=function(r,e){var t={};for(var s in r)Object.prototype.hasOwnProperty.call(r,s)&&e.indexOf(s)<0&&(t[s]=r[s]);if(r!=null&&typeof Object.getOwnPropertySymbols=="function")for(var i=0,s=Object.getOwnPropertySymbols(r);i<s.length;i++)e.indexOf(s[i])<0&&Object.prototype.propertyIsEnumerable.call(r,s[i])&&(t[s[i]]=r[s[i]]);return t};class pa{constructor({url:e="",headers:t={},fetch:s}){this.url=e,this.headers=t,this.fetch=xr(s),this.mfa={listFactors:this._listFactors.bind(this),deleteFactor:this._deleteFactor.bind(this)}}async signOut(e,t=vt[0]){if(vt.indexOf(t)<0)throw new Error(`@supabase/auth-js: Parameter scope must be one of ${vt.join(", ")}`);try{return await k(this.fetch,"POST",`${this.url}/logout?scope=${t}`,{headers:this.headers,jwt:e,noResolveJson:!0}),{data:null,error:null}}catch(s){if(w(s))return{data:null,error:s};throw s}}async inviteUserByEmail(e,t={}){try{return await k(this.fetch,"POST",`${this.url}/invite`,{body:{email:e,data:t.data},headers:this.headers,redirectTo:t.redirectTo,xform:V})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async generateLink(e){try{const{options:t}=e,s=ga(e,["options"]),i=Object.assign(Object.assign({},s),t);return"newEmail"in s&&(i.new_email=s?.newEmail,delete i.newEmail),await k(this.fetch,"POST",`${this.url}/admin/generate_link`,{body:i,headers:this.headers,xform:da,redirectTo:t?.redirectTo})}catch(t){if(w(t))return{data:{properties:null,user:null},error:t};throw t}}async createUser(e){try{return await k(this.fetch,"POST",`${this.url}/admin/users`,{body:e,headers:this.headers,xform:V})}catch(t){if(w(t))return{data:{user:null},error:t};throw t}}async listUsers(e){var t,s,i,n,a,o,l;try{const u={nextPage:null,lastPage:0,total:0},d=await k(this.fetch,"GET",`${this.url}/admin/users`,{headers:this.headers,noResolveJson:!0,query:{page:(s=(t=e?.page)===null||t===void 0?void 0:t.toString())!==null&&s!==void 0?s:"",per_page:(n=(i=e?.perPage)===null||i===void 0?void 0:i.toString())!==null&&n!==void 0?n:""},xform:ha});if(d.error)throw d.error;const c=await d.json(),f=(a=d.headers.get("x-total-count"))!==null&&a!==void 0?a:0,h=(l=(o=d.headers.get("link"))===null||o===void 0?void 0:o.split(","))!==null&&l!==void 0?l:[];return h.length>0&&(h.forEach(p=>{const m=parseInt(p.split(";")[0].split("=")[1].substring(0,1)),y=JSON.parse(p.split(";")[1].split("=")[1]);u[`${y}Page`]=m}),u.total=parseInt(f)),{data:Object.assign(Object.assign({},c),u),error:null}}catch(u){if(w(u))return{data:{users:[]},error:u};throw u}}async getUserById(e){he(e);try{return await k(this.fetch,"GET",`${this.url}/admin/users/${e}`,{headers:this.headers,xform:V})}catch(t){if(w(t))return{data:{user:null},error:t};throw t}}async updateUserById(e,t){he(e);try{return await k(this.fetch,"PUT",`${this.url}/admin/users/${e}`,{body:t,headers:this.headers,xform:V})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async deleteUser(e,t=!1){he(e);try{return await k(this.fetch,"DELETE",`${this.url}/admin/users/${e}`,{headers:this.headers,body:{should_soft_delete:t},xform:V})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async _listFactors(e){he(e.userId);try{const{data:t,error:s}=await k(this.fetch,"GET",`${this.url}/admin/users/${e.userId}/factors`,{headers:this.headers,xform:i=>({data:{factors:i},error:null})});return{data:t,error:s}}catch(t){if(w(t))return{data:null,error:t};throw t}}async _deleteFactor(e){he(e.userId),he(e.id);try{return{data:await k(this.fetch,"DELETE",`${this.url}/admin/users/${e.userId}/factors/${e.id}`,{headers:this.headers}),error:null}}catch(t){if(w(t))return{data:null,error:t};throw t}}}function Hs(r={}){return{getItem:e=>r[e]||null,setItem:(e,t)=>{r[e]=t},removeItem:e=>{delete r[e]}}}function va(){if(typeof globalThis!="object")try{Object.defineProperty(Object.prototype,"__magic__",{get:function(){return this},configurable:!0}),__magic__.globalThis=__magic__,delete Object.prototype.__magic__}catch{typeof self<"u"&&(self.globalThis=self)}}const fe={debug:!!(globalThis&&Tr()&&globalThis.localStorage&&globalThis.localStorage.getItem("supabase.gotrue-js.locks.debug")==="true")};class jr extends Error{constructor(e){super(e),this.isAcquireTimeout=!0}}class _a extends jr{}async function ya(r,e,t){fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquire lock",r,e);const s=new globalThis.AbortController;return e>0&&setTimeout(()=>{s.abort(),fe.debug&&console.log("@supabase/gotrue-js: navigatorLock acquire timed out",r)},e),await Promise.resolve().then(()=>globalThis.navigator.locks.request(r,e===0?{mode:"exclusive",ifAvailable:!0}:{mode:"exclusive",signal:s.signal},async i=>{if(i){fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: acquired",r,i.name);try{return await t()}finally{fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: released",r,i.name)}}else{if(e===0)throw fe.debug&&console.log("@supabase/gotrue-js: navigatorLock: not immediately available",r),new _a(`Acquiring an exclusive Navigator LockManager lock "${r}" immediately failed`);if(fe.debug)try{const n=await globalThis.navigator.locks.query();console.log("@supabase/gotrue-js: Navigator LockManager state",JSON.stringify(n,null,"  "))}catch(n){console.warn("@supabase/gotrue-js: Error when querying Navigator LockManager state",n)}return console.warn("@supabase/gotrue-js: Navigator LockManager returned a null lock when using #request without ifAvailable set to true, it appears this browser is not following the LockManager spec https://developer.mozilla.org/en-US/docs/Web/API/LockManager/request"),await t()}}))}va();const ma={url:xn,storageKey:jn,autoRefreshToken:!0,persistSession:!0,detectSessionInUrl:!0,headers:Cn,flowType:"implicit",debug:!1,hasCustomAuthorizationHeader:!1};async function Gs(r,e,t){return await t()}const ge={};class qe{constructor(e){var t,s;this.userStorage=null,this.memoryStorage=null,this.stateChangeEmitters=new Map,this.autoRefreshTicker=null,this.visibilityChangedCallback=null,this.refreshingDeferred=null,this.initializePromise=null,this.detectSessionInUrl=!0,this.hasCustomAuthorizationHeader=!1,this.suppressGetSessionWarning=!1,this.lockAcquired=!1,this.pendingInLock=[],this.broadcastChannel=null,this.logger=console.log,this.instanceID=qe.nextInstanceID,qe.nextInstanceID+=1,this.instanceID>0&&L()&&console.warn("Multiple GoTrueClient instances detected in the same browser context. It is not an error, but this should be avoided as it may produce undefined behavior when used concurrently under the same storage key.");const i=Object.assign(Object.assign({},ma),e);if(this.logDebugMessages=!!i.debug,typeof i.debug=="function"&&(this.logger=i.debug),this.persistSession=i.persistSession,this.storageKey=i.storageKey,this.autoRefreshToken=i.autoRefreshToken,this.admin=new pa({url:i.url,headers:i.headers,fetch:i.fetch}),this.url=i.url,this.headers=i.headers,this.fetch=xr(i.fetch),this.lock=i.lock||Gs,this.detectSessionInUrl=i.detectSessionInUrl,this.flowType=i.flowType,this.hasCustomAuthorizationHeader=i.hasCustomAuthorizationHeader,i.lock?this.lock=i.lock:L()&&(!((t=globalThis?.navigator)===null||t===void 0)&&t.locks)?this.lock=ya:this.lock=Gs,this.jwks||(this.jwks={keys:[]},this.jwks_cached_at=Number.MIN_SAFE_INTEGER),this.mfa={verify:this._verify.bind(this),enroll:this._enroll.bind(this),unenroll:this._unenroll.bind(this),challenge:this._challenge.bind(this),listFactors:this._listFactors.bind(this),challengeAndVerify:this._challengeAndVerify.bind(this),getAuthenticatorAssuranceLevel:this._getAuthenticatorAssuranceLevel.bind(this)},this.persistSession?(i.storage?this.storage=i.storage:Tr()?this.storage=globalThis.localStorage:(this.memoryStorage={},this.storage=Hs(this.memoryStorage)),i.userStorage&&(this.userStorage=i.userStorage)):(this.memoryStorage={},this.storage=Hs(this.memoryStorage)),L()&&globalThis.BroadcastChannel&&this.persistSession&&this.storageKey){try{this.broadcastChannel=new globalThis.BroadcastChannel(this.storageKey)}catch(n){console.error("Failed to create a new BroadcastChannel, multi-tab state changes will not be available",n)}(s=this.broadcastChannel)===null||s===void 0||s.addEventListener("message",async n=>{this._debug("received broadcast notification from other tab or client",n),await this._notifyAllSubscribers(n.data.event,n.data.session,!1)})}this.initialize()}get jwks(){var e,t;return(t=(e=ge[this.storageKey])===null||e===void 0?void 0:e.jwks)!==null&&t!==void 0?t:{keys:[]}}set jwks(e){ge[this.storageKey]=Object.assign(Object.assign({},ge[this.storageKey]),{jwks:e})}get jwks_cached_at(){var e,t;return(t=(e=ge[this.storageKey])===null||e===void 0?void 0:e.cachedAt)!==null&&t!==void 0?t:Number.MIN_SAFE_INTEGER}set jwks_cached_at(e){ge[this.storageKey]=Object.assign(Object.assign({},ge[this.storageKey]),{cachedAt:e})}_debug(...e){return this.logDebugMessages&&this.logger(`GoTrueClient@${this.instanceID} (${Pr}) ${new Date().toISOString()}`,...e),this}async initialize(){return this.initializePromise?await this.initializePromise:(this.initializePromise=(async()=>await this._acquireLock(-1,async()=>await this._initialize()))(),await this.initializePromise)}async _initialize(){var e;try{const t=Jn(window.location.href);let s="none";if(this._isImplicitGrantCallback(t)?s="implicit":await this._isPKCECallback(t)&&(s="pkce"),L()&&this.detectSessionInUrl&&s!=="none"){const{data:i,error:n}=await this._getSessionFromURL(t,s);if(n){if(this._debug("#_initialize()","error detecting session from URL",n),Un(n)){const l=(e=n.details)===null||e===void 0?void 0:e.code;if(l==="identity_already_exists"||l==="identity_not_found"||l==="single_identity_not_deletable")return{error:n}}return await this._removeSession(),{error:n}}const{session:a,redirectType:o}=i;return this._debug("#_initialize()","detected session in URL",a,"redirect type",o),await this._saveSession(a),setTimeout(async()=>{o==="recovery"?await this._notifyAllSubscribers("PASSWORD_RECOVERY",a):await this._notifyAllSubscribers("SIGNED_IN",a)},0),{error:null}}return await this._recoverAndRefresh(),{error:null}}catch(t){return w(t)?{error:t}:{error:new Or("Unexpected error during initialization",t)}}finally{await this._handleVisibilityChange(),this._debug("#_initialize()","end")}}async signInAnonymously(e){var t,s,i;try{const n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{data:(s=(t=e?.options)===null||t===void 0?void 0:t.data)!==null&&s!==void 0?s:{},gotrue_meta_security:{captcha_token:(i=e?.options)===null||i===void 0?void 0:i.captchaToken}},xform:B}),{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(w(n))return{data:{user:null,session:null},error:n};throw n}}async signUp(e){var t,s,i;try{let n;if("email"in e){const{email:d,password:c,options:f}=e;let h=null,p=null;this.flowType==="pkce"&&([h,p]=await de(this.storage,this.storageKey)),n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,redirectTo:f?.emailRedirectTo,body:{email:d,password:c,data:(t=f?.data)!==null&&t!==void 0?t:{},gotrue_meta_security:{captcha_token:f?.captchaToken},code_challenge:h,code_challenge_method:p},xform:B})}else if("phone"in e){const{phone:d,password:c,options:f}=e;n=await k(this.fetch,"POST",`${this.url}/signup`,{headers:this.headers,body:{phone:d,password:c,data:(s=f?.data)!==null&&s!==void 0?s:{},channel:(i=f?.channel)!==null&&i!==void 0?i:"sms",gotrue_meta_security:{captcha_token:f?.captchaToken}},xform:B})}else throw new tt("You must provide either an email or phone number and a password");const{data:a,error:o}=n;if(o||!a)return{data:{user:null,session:null},error:o};const l=a.session,u=a.user;return a.session&&(await this._saveSession(a.session),await this._notifyAllSubscribers("SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(n){if(w(n))return{data:{user:null,session:null},error:n};throw n}}async signInWithPassword(e){try{let t;if("email"in e){const{email:n,password:a,options:o}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{email:n,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:zs})}else if("phone"in e){const{phone:n,password:a,options:o}=e;t=await k(this.fetch,"POST",`${this.url}/token?grant_type=password`,{headers:this.headers,body:{phone:n,password:a,gotrue_meta_security:{captcha_token:o?.captchaToken}},xform:zs})}else throw new tt("You must provide either an email or phone number and a password");const{data:s,error:i}=t;return i?{data:{user:null,session:null},error:i}:!s||!s.session||!s.user?{data:{user:null,session:null},error:new et}:(s.session&&(await this._saveSession(s.session),await this._notifyAllSubscribers("SIGNED_IN",s.session)),{data:Object.assign({user:s.user,session:s.session},s.weak_password?{weakPassword:s.weak_password}:null),error:i})}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOAuth(e){var t,s,i,n;return await this._handleProviderSignIn(e.provider,{redirectTo:(t=e.options)===null||t===void 0?void 0:t.redirectTo,scopes:(s=e.options)===null||s===void 0?void 0:s.scopes,queryParams:(i=e.options)===null||i===void 0?void 0:i.queryParams,skipBrowserRedirect:(n=e.options)===null||n===void 0?void 0:n.skipBrowserRedirect})}async exchangeCodeForSession(e){return await this.initializePromise,this._acquireLock(-1,async()=>this._exchangeCodeForSession(e))}async signInWithWeb3(e){const{chain:t}=e;if(t==="solana")return await this.signInWithSolana(e);throw new Error(`@supabase/auth-js: Unsupported chain "${t}"`)}async signInWithSolana(e){var t,s,i,n,a,o,l,u,d,c,f,h;let p,m;if("message"in e)p=e.message,m=e.signature;else{const{chain:y,wallet:S,statement:v,options:_}=e;let g;if(L())if(typeof S=="object")g=S;else{const E=window;if("solana"in E&&typeof E.solana=="object"&&("signIn"in E.solana&&typeof E.solana.signIn=="function"||"signMessage"in E.solana&&typeof E.solana.signMessage=="function"))g=E.solana;else throw new Error("@supabase/auth-js: No compatible Solana wallet interface on the window object (window.solana) detected. Make sure the user already has a wallet installed and connected for this app. Prefer passing the wallet interface object directly to signInWithWeb3({ chain: 'solana', wallet: resolvedUserWallet }) instead.")}else{if(typeof S!="object"||!_?.url)throw new Error("@supabase/auth-js: Both wallet and url must be specified in non-browser environments.");g=S}const b=new URL((t=_?.url)!==null&&t!==void 0?t:window.location.href);if("signIn"in g&&g.signIn){const E=await g.signIn(Object.assign(Object.assign(Object.assign({issuedAt:new Date().toISOString()},_?.signInWithSolana),{version:"1",domain:b.host,uri:b.href}),v?{statement:v}:null));let R;if(Array.isArray(E)&&E[0]&&typeof E[0]=="object")R=E[0];else if(E&&typeof E=="object"&&"signedMessage"in E&&"signature"in E)R=E;else throw new Error("@supabase/auth-js: Wallet method signIn() returned unrecognized value");if("signedMessage"in R&&"signature"in R&&(typeof R.signedMessage=="string"||R.signedMessage instanceof Uint8Array)&&R.signature instanceof Uint8Array)p=typeof R.signedMessage=="string"?R.signedMessage:new TextDecoder().decode(R.signedMessage),m=R.signature;else throw new Error("@supabase/auth-js: Wallet method signIn() API returned object without signedMessage and signature fields")}else{if(!("signMessage"in g)||typeof g.signMessage!="function"||!("publicKey"in g)||typeof g!="object"||!g.publicKey||!("toBase58"in g.publicKey)||typeof g.publicKey.toBase58!="function")throw new Error("@supabase/auth-js: Wallet does not have a compatible signMessage() and publicKey.toBase58() API");p=[`${b.host} wants you to sign in with your Solana account:`,g.publicKey.toBase58(),...v?["",v,""]:[""],"Version: 1",`URI: ${b.href}`,`Issued At: ${(i=(s=_?.signInWithSolana)===null||s===void 0?void 0:s.issuedAt)!==null&&i!==void 0?i:new Date().toISOString()}`,...!((n=_?.signInWithSolana)===null||n===void 0)&&n.notBefore?[`Not Before: ${_.signInWithSolana.notBefore}`]:[],...!((a=_?.signInWithSolana)===null||a===void 0)&&a.expirationTime?[`Expiration Time: ${_.signInWithSolana.expirationTime}`]:[],...!((o=_?.signInWithSolana)===null||o===void 0)&&o.chainId?[`Chain ID: ${_.signInWithSolana.chainId}`]:[],...!((l=_?.signInWithSolana)===null||l===void 0)&&l.nonce?[`Nonce: ${_.signInWithSolana.nonce}`]:[],...!((u=_?.signInWithSolana)===null||u===void 0)&&u.requestId?[`Request ID: ${_.signInWithSolana.requestId}`]:[],...!((c=(d=_?.signInWithSolana)===null||d===void 0?void 0:d.resources)===null||c===void 0)&&c.length?["Resources",..._.signInWithSolana.resources.map(R=>`- ${R}`)]:[]].join(`
`);const E=await g.signMessage(new TextEncoder().encode(p),"utf8");if(!E||!(E instanceof Uint8Array))throw new Error("@supabase/auth-js: Wallet signMessage() API returned an recognized value");m=E}}try{const{data:y,error:S}=await k(this.fetch,"POST",`${this.url}/token?grant_type=web3`,{headers:this.headers,body:Object.assign({chain:"solana",message:p,signature:zn(m)},!((f=e.options)===null||f===void 0)&&f.captchaToken?{gotrue_meta_security:{captcha_token:(h=e.options)===null||h===void 0?void 0:h.captchaToken}}:null),xform:B});if(S)throw S;return!y||!y.session||!y.user?{data:{user:null,session:null},error:new et}:(y.session&&(await this._saveSession(y.session),await this._notifyAllSubscribers("SIGNED_IN",y.session)),{data:Object.assign({},y),error:S})}catch(y){if(w(y))return{data:{user:null,session:null},error:y};throw y}}async _exchangeCodeForSession(e){const t=await Z(this.storage,`${this.storageKey}-code-verifier`),[s,i]=(t??"").split("/");try{const{data:n,error:a}=await k(this.fetch,"POST",`${this.url}/token?grant_type=pkce`,{headers:this.headers,body:{auth_code:e,code_verifier:s},xform:B});if(await G(this.storage,`${this.storageKey}-code-verifier`),a)throw a;return!n||!n.session||!n.user?{data:{user:null,session:null,redirectType:null},error:new et}:(n.session&&(await this._saveSession(n.session),await this._notifyAllSubscribers("SIGNED_IN",n.session)),{data:Object.assign(Object.assign({},n),{redirectType:i??null}),error:a})}catch(n){if(w(n))return{data:{user:null,session:null,redirectType:null},error:n};throw n}}async signInWithIdToken(e){try{const{options:t,provider:s,token:i,access_token:n,nonce:a}=e,o=await k(this.fetch,"POST",`${this.url}/token?grant_type=id_token`,{headers:this.headers,body:{provider:s,id_token:i,access_token:n,nonce:a,gotrue_meta_security:{captcha_token:t?.captchaToken}},xform:B}),{data:l,error:u}=o;return u?{data:{user:null,session:null},error:u}:!l||!l.session||!l.user?{data:{user:null,session:null},error:new et}:(l.session&&(await this._saveSession(l.session),await this._notifyAllSubscribers("SIGNED_IN",l.session)),{data:l,error:u})}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async signInWithOtp(e){var t,s,i,n,a;try{if("email"in e){const{email:o,options:l}=e;let u=null,d=null;this.flowType==="pkce"&&([u,d]=await de(this.storage,this.storageKey));const{error:c}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{email:o,data:(t=l?.data)!==null&&t!==void 0?t:{},create_user:(s=l?.shouldCreateUser)!==null&&s!==void 0?s:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},code_challenge:u,code_challenge_method:d},redirectTo:l?.emailRedirectTo});return{data:{user:null,session:null},error:c}}if("phone"in e){const{phone:o,options:l}=e,{data:u,error:d}=await k(this.fetch,"POST",`${this.url}/otp`,{headers:this.headers,body:{phone:o,data:(i=l?.data)!==null&&i!==void 0?i:{},create_user:(n=l?.shouldCreateUser)!==null&&n!==void 0?n:!0,gotrue_meta_security:{captcha_token:l?.captchaToken},channel:(a=l?.channel)!==null&&a!==void 0?a:"sms"}});return{data:{user:null,session:null,messageId:u?.message_id},error:d}}throw new tt("You must provide either an email or phone number.")}catch(o){if(w(o))return{data:{user:null,session:null},error:o};throw o}}async verifyOtp(e){var t,s;try{let i,n;"options"in e&&(i=(t=e.options)===null||t===void 0?void 0:t.redirectTo,n=(s=e.options)===null||s===void 0?void 0:s.captchaToken);const{data:a,error:o}=await k(this.fetch,"POST",`${this.url}/verify`,{headers:this.headers,body:Object.assign(Object.assign({},e),{gotrue_meta_security:{captcha_token:n}}),redirectTo:i,xform:B});if(o)throw o;if(!a)throw new Error("An error occurred on token verification.");const l=a.session,u=a.user;return l?.access_token&&(await this._saveSession(l),await this._notifyAllSubscribers(e.type=="recovery"?"PASSWORD_RECOVERY":"SIGNED_IN",l)),{data:{user:u,session:l},error:null}}catch(i){if(w(i))return{data:{user:null,session:null},error:i};throw i}}async signInWithSSO(e){var t,s,i;try{let n=null,a=null;return this.flowType==="pkce"&&([n,a]=await de(this.storage,this.storageKey)),await k(this.fetch,"POST",`${this.url}/sso`,{body:Object.assign(Object.assign(Object.assign(Object.assign(Object.assign({},"providerId"in e?{provider_id:e.providerId}:null),"domain"in e?{domain:e.domain}:null),{redirect_to:(s=(t=e.options)===null||t===void 0?void 0:t.redirectTo)!==null&&s!==void 0?s:void 0}),!((i=e?.options)===null||i===void 0)&&i.captchaToken?{gotrue_meta_security:{captcha_token:e.options.captchaToken}}:null),{skip_http_redirect:!0,code_challenge:n,code_challenge_method:a}),headers:this.headers,xform:ua})}catch(n){if(w(n))return{data:null,error:n};throw n}}async reauthenticate(){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._reauthenticate())}async _reauthenticate(){try{return await this._useSession(async e=>{const{data:{session:t},error:s}=e;if(s)throw s;if(!t)throw new J;const{error:i}=await k(this.fetch,"GET",`${this.url}/reauthenticate`,{headers:this.headers,jwt:t.access_token});return{data:{user:null,session:null},error:i}})}catch(e){if(w(e))return{data:{user:null,session:null},error:e};throw e}}async resend(e){try{const t=`${this.url}/resend`;if("email"in e){const{email:s,type:i,options:n}=e,{error:a}=await k(this.fetch,"POST",t,{headers:this.headers,body:{email:s,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}},redirectTo:n?.emailRedirectTo});return{data:{user:null,session:null},error:a}}else if("phone"in e){const{phone:s,type:i,options:n}=e,{data:a,error:o}=await k(this.fetch,"POST",t,{headers:this.headers,body:{phone:s,type:i,gotrue_meta_security:{captcha_token:n?.captchaToken}}});return{data:{user:null,session:null,messageId:a?.message_id},error:o}}throw new tt("You must provide either an email or phone number and a type")}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async getSession(){return await this.initializePromise,await this._acquireLock(-1,async()=>this._useSession(async t=>t))}async _acquireLock(e,t){this._debug("#_acquireLock","begin",e);try{if(this.lockAcquired){const s=this.pendingInLock.length?this.pendingInLock[this.pendingInLock.length-1]:Promise.resolve(),i=(async()=>(await s,await t()))();return this.pendingInLock.push((async()=>{try{await i}catch{}})()),i}return await this.lock(`lock:${this.storageKey}`,e,async()=>{this._debug("#_acquireLock","lock acquired for storage key",this.storageKey);try{this.lockAcquired=!0;const s=t();for(this.pendingInLock.push((async()=>{try{await s}catch{}})()),await s;this.pendingInLock.length;){const i=[...this.pendingInLock];await Promise.all(i),this.pendingInLock.splice(0,i.length)}return await s}finally{this._debug("#_acquireLock","lock released for storage key",this.storageKey),this.lockAcquired=!1}})}finally{this._debug("#_acquireLock","end")}}async _useSession(e){this._debug("#_useSession","begin");try{const t=await this.__loadSession();return await e(t)}finally{this._debug("#_useSession","end")}}async __loadSession(){this._debug("#__loadSession()","begin"),this.lockAcquired||this._debug("#__loadSession()","used outside of an acquired lock!",new Error().stack);try{let e=null;const t=await Z(this.storage,this.storageKey);if(this._debug("#getSession()","session from storage",t),t!==null&&(this._isValidSession(t)?e=t:(this._debug("#getSession()","session from storage is not valid"),await this._removeSession())),!e)return{data:{session:null},error:null};const s=e.expires_at?e.expires_at*1e3-Date.now()<ht:!1;if(this._debug("#__loadSession()",`session has${s?"":" not"} expired`,"expires_at",e.expires_at),!s){if(this.userStorage){const a=await Z(this.userStorage,this.storageKey+"-user");a?.user?e.user=a.user:e.user=pt()}if(this.storage.isServer&&e.user){let a=this.suppressGetSessionWarning;e=new Proxy(e,{get:(l,u,d)=>(!a&&u==="user"&&(console.warn("Using the user object as returned from supabase.auth.getSession() or from some supabase.auth.onAuthStateChange() events could be insecure! This value comes directly from the storage medium (usually cookies on the server) and may not be authentic. Use supabase.auth.getUser() instead which authenticates the data by contacting the Supabase Auth server."),a=!0,this.suppressGetSessionWarning=!0),Reflect.get(l,u,d))})}return{data:{session:e},error:null}}const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{session:null},error:n}:{data:{session:i},error:null}}finally{this._debug("#__loadSession()","end")}}async getUser(e){return e?await this._getUser(e):(await this.initializePromise,await this._acquireLock(-1,async()=>await this._getUser()))}async _getUser(e){try{return e?await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:e,xform:V}):await this._useSession(async t=>{var s,i,n;const{data:a,error:o}=t;if(o)throw o;return!(!((s=a.session)===null||s===void 0)&&s.access_token)&&!this.hasCustomAuthorizationHeader?{data:{user:null},error:new J}:await k(this.fetch,"GET",`${this.url}/user`,{headers:this.headers,jwt:(n=(i=a.session)===null||i===void 0?void 0:i.access_token)!==null&&n!==void 0?n:void 0,xform:V})})}catch(t){if(w(t))return Ln(t)&&(await this._removeSession(),await G(this.storage,`${this.storageKey}-code-verifier`)),{data:{user:null},error:t};throw t}}async updateUser(e,t={}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._updateUser(e,t))}async _updateUser(e,t={}){try{return await this._useSession(async s=>{const{data:i,error:n}=s;if(n)throw n;if(!i.session)throw new J;const a=i.session;let o=null,l=null;this.flowType==="pkce"&&e.email!=null&&([o,l]=await de(this.storage,this.storageKey));const{data:u,error:d}=await k(this.fetch,"PUT",`${this.url}/user`,{headers:this.headers,redirectTo:t?.emailRedirectTo,body:Object.assign(Object.assign({},e),{code_challenge:o,code_challenge_method:l}),jwt:a.access_token,xform:V});if(d)throw d;return a.user=u.user,await this._saveSession(a),await this._notifyAllSubscribers("USER_UPDATED",a),{data:{user:a.user},error:null}})}catch(s){if(w(s))return{data:{user:null},error:s};throw s}}async setSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._setSession(e))}async _setSession(e){try{if(!e.access_token||!e.refresh_token)throw new J;const t=Date.now()/1e3;let s=t,i=!0,n=null;const{payload:a}=gt(e.access_token);if(a.exp&&(s=a.exp,i=s<=t),i){const{session:o,error:l}=await this._callRefreshToken(e.refresh_token);if(l)return{data:{user:null,session:null},error:l};if(!o)return{data:{user:null,session:null},error:null};n=o}else{const{data:o,error:l}=await this._getUser(e.access_token);if(l)throw l;n={access_token:e.access_token,refresh_token:e.refresh_token,user:o.user,token_type:"bearer",expires_in:s-t,expires_at:s},await this._saveSession(n),await this._notifyAllSubscribers("SIGNED_IN",n)}return{data:{user:n.user,session:n},error:null}}catch(t){if(w(t))return{data:{session:null,user:null},error:t};throw t}}async refreshSession(e){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._refreshSession(e))}async _refreshSession(e){try{return await this._useSession(async t=>{var s;if(!e){const{data:a,error:o}=t;if(o)throw o;e=(s=a.session)!==null&&s!==void 0?s:void 0}if(!e?.refresh_token)throw new J;const{session:i,error:n}=await this._callRefreshToken(e.refresh_token);return n?{data:{user:null,session:null},error:n}:i?{data:{user:i.user,session:i},error:null}:{data:{user:null,session:null},error:null}})}catch(t){if(w(t))return{data:{user:null,session:null},error:t};throw t}}async _getSessionFromURL(e,t){try{if(!L())throw new st("No browser detected.");if(e.error||e.error_description||e.error_code)throw new st(e.error_description||"Error in URL with unspecified error_description",{error:e.error||"unspecified_error",code:e.error_code||"unspecified_code"});switch(t){case"implicit":if(this.flowType==="pkce")throw new Us("Not a valid PKCE flow url.");break;case"pkce":if(this.flowType==="implicit")throw new st("Not a valid implicit grant flow url.");break;default:}if(t==="pkce"){if(this._debug("#_initialize()","begin","is PKCE flow",!0),!e.code)throw new Us("No code detected.");const{data:v,error:_}=await this._exchangeCodeForSession(e.code);if(_)throw _;const g=new URL(window.location.href);return g.searchParams.delete("code"),window.history.replaceState(window.history.state,"",g.toString()),{data:{session:v.session,redirectType:null},error:null}}const{provider_token:s,provider_refresh_token:i,access_token:n,refresh_token:a,expires_in:o,expires_at:l,token_type:u}=e;if(!n||!o||!a||!u)throw new st("No session defined in URL");const d=Math.round(Date.now()/1e3),c=parseInt(o);let f=d+c;l&&(f=parseInt(l));const h=f-d;h*1e3<=pe&&console.warn(`@supabase/gotrue-js: Session as retrieved from URL expires in ${h}s, should have been closer to ${c}s`);const p=f-c;d-p>=120?console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued over 120s ago, URL could be stale",p,f,d):d-p<0&&console.warn("@supabase/gotrue-js: Session as retrieved from URL was issued in the future? Check the device clock for skew",p,f,d);const{data:m,error:y}=await this._getUser(n);if(y)throw y;const S={provider_token:s,provider_refresh_token:i,access_token:n,expires_in:c,expires_at:f,refresh_token:a,token_type:u,user:m.user};return window.location.hash="",this._debug("#_getSessionFromURL()","clearing window.location.hash"),{data:{session:S,redirectType:e.type},error:null}}catch(s){if(w(s))return{data:{session:null,redirectType:null},error:s};throw s}}_isImplicitGrantCallback(e){return!!(e.access_token||e.error_description)}async _isPKCECallback(e){const t=await Z(this.storage,`${this.storageKey}-code-verifier`);return!!(e.code&&t)}async signOut(e={scope:"global"}){return await this.initializePromise,await this._acquireLock(-1,async()=>await this._signOut(e))}async _signOut({scope:e}={scope:"global"}){return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{error:n};const a=(s=i.session)===null||s===void 0?void 0:s.access_token;if(a){const{error:o}=await this.admin.signOut(a,e);if(o&&!(Dn(o)&&(o.status===404||o.status===401||o.status===403)))return{error:o}}return e!=="others"&&(await this._removeSession(),await G(this.storage,`${this.storageKey}-code-verifier`)),{error:null}})}onAuthStateChange(e){const t=Gn(),s={id:t,callback:e,unsubscribe:()=>{this._debug("#unsubscribe()","state change callback with id removed",t),this.stateChangeEmitters.delete(t)}};return this._debug("#onAuthStateChange()","registered callback with id",t),this.stateChangeEmitters.set(t,s),(async()=>(await this.initializePromise,await this._acquireLock(-1,async()=>{this._emitInitialSession(t)})))(),{data:{subscription:s}}}async _emitInitialSession(e){return await this._useSession(async t=>{var s,i;try{const{data:{session:n},error:a}=t;if(a)throw a;await((s=this.stateChangeEmitters.get(e))===null||s===void 0?void 0:s.callback("INITIAL_SESSION",n)),this._debug("INITIAL_SESSION","callback id",e,"session",n)}catch(n){await((i=this.stateChangeEmitters.get(e))===null||i===void 0?void 0:i.callback("INITIAL_SESSION",null)),this._debug("INITIAL_SESSION","callback id",e,"error",n),console.error(n)}})}async resetPasswordForEmail(e,t={}){let s=null,i=null;this.flowType==="pkce"&&([s,i]=await de(this.storage,this.storageKey,!0));try{return await k(this.fetch,"POST",`${this.url}/recover`,{body:{email:e,code_challenge:s,code_challenge_method:i,gotrue_meta_security:{captcha_token:t.captchaToken}},headers:this.headers,redirectTo:t.redirectTo})}catch(n){if(w(n))return{data:null,error:n};throw n}}async getUserIdentities(){var e;try{const{data:t,error:s}=await this.getUser();if(s)throw s;return{data:{identities:(e=t.user.identities)!==null&&e!==void 0?e:[]},error:null}}catch(t){if(w(t))return{data:null,error:t};throw t}}async linkIdentity(e){var t;try{const{data:s,error:i}=await this._useSession(async n=>{var a,o,l,u,d;const{data:c,error:f}=n;if(f)throw f;const h=await this._getUrlForProvider(`${this.url}/user/identities/authorize`,e.provider,{redirectTo:(a=e.options)===null||a===void 0?void 0:a.redirectTo,scopes:(o=e.options)===null||o===void 0?void 0:o.scopes,queryParams:(l=e.options)===null||l===void 0?void 0:l.queryParams,skipBrowserRedirect:!0});return await k(this.fetch,"GET",h,{headers:this.headers,jwt:(d=(u=c.session)===null||u===void 0?void 0:u.access_token)!==null&&d!==void 0?d:void 0})});if(i)throw i;return L()&&!(!((t=e.options)===null||t===void 0)&&t.skipBrowserRedirect)&&window.location.assign(s?.url),{data:{provider:e.provider,url:s?.url},error:null}}catch(s){if(w(s))return{data:{provider:e.provider,url:null},error:s};throw s}}async unlinkIdentity(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)throw a;return await k(this.fetch,"DELETE",`${this.url}/user/identities/${e.identity_id}`,{headers:this.headers,jwt:(i=(s=n.session)===null||s===void 0?void 0:s.access_token)!==null&&i!==void 0?i:void 0})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _refreshAccessToken(e){const t=`#_refreshAccessToken(${e.substring(0,5)}...)`;this._debug(t,"begin");try{const s=Date.now();return await Qn(async i=>(i>0&&await Vn(200*Math.pow(2,i-1)),this._debug(t,"refreshing attempt",i),await k(this.fetch,"POST",`${this.url}/token?grant_type=refresh_token`,{body:{refresh_token:e},headers:this.headers,xform:B})),(i,n)=>{const a=200*Math.pow(2,i);return n&&ft(n)&&Date.now()+a-s<pe})}catch(s){if(this._debug(t,"error",s),w(s))return{data:{session:null,user:null},error:s};throw s}finally{this._debug(t,"end")}}_isValidSession(e){return typeof e=="object"&&e!==null&&"access_token"in e&&"refresh_token"in e&&"expires_at"in e}async _handleProviderSignIn(e,t){const s=await this._getUrlForProvider(`${this.url}/authorize`,e,{redirectTo:t.redirectTo,scopes:t.scopes,queryParams:t.queryParams});return this._debug("#_handleProviderSignIn()","provider",e,"options",t,"url",s),L()&&!t.skipBrowserRedirect&&window.location.assign(s),{data:{provider:e,url:s},error:null}}async _recoverAndRefresh(){var e,t;const s="#_recoverAndRefresh()";this._debug(s,"begin");try{const i=await Z(this.storage,this.storageKey);if(i&&this.userStorage){let a=await Z(this.userStorage,this.storageKey+"-user");!this.storage.isServer&&Object.is(this.storage,this.userStorage)&&!a&&(a={user:i.user},await ve(this.userStorage,this.storageKey+"-user",a)),i.user=(e=a?.user)!==null&&e!==void 0?e:pt()}else if(i&&!i.user&&!i.user){const a=await Z(this.storage,this.storageKey+"-user");a&&a?.user?(i.user=a.user,await G(this.storage,this.storageKey+"-user"),await ve(this.storage,this.storageKey,i)):i.user=pt()}if(this._debug(s,"session from storage",i),!this._isValidSession(i)){this._debug(s,"session is not valid"),i!==null&&await this._removeSession();return}const n=((t=i.expires_at)!==null&&t!==void 0?t:1/0)*1e3-Date.now()<ht;if(this._debug(s,`session has${n?"":" not"} expired with margin of ${ht}s`),n){if(this.autoRefreshToken&&i.refresh_token){const{error:a}=await this._callRefreshToken(i.refresh_token);a&&(console.error(a),ft(a)||(this._debug(s,"refresh failed with a non-retryable error, removing the session",a),await this._removeSession()))}}else if(i.user&&i.user.__isUserNotAvailableProxy===!0)try{const{data:a,error:o}=await this._getUser(i.access_token);!o&&a?.user?(i.user=a.user,await this._saveSession(i),await this._notifyAllSubscribers("SIGNED_IN",i)):this._debug(s,"could not get user data, skipping SIGNED_IN notification")}catch(a){console.error("Error getting user data:",a),this._debug(s,"error getting user data, skipping SIGNED_IN notification",a)}else await this._notifyAllSubscribers("SIGNED_IN",i)}catch(i){this._debug(s,"error",i),console.error(i);return}finally{this._debug(s,"end")}}async _callRefreshToken(e){var t,s;if(!e)throw new J;if(this.refreshingDeferred)return this.refreshingDeferred.promise;const i=`#_callRefreshToken(${e.substring(0,5)}...)`;this._debug(i,"begin");try{this.refreshingDeferred=new ct;const{data:n,error:a}=await this._refreshAccessToken(e);if(a)throw a;if(!n.session)throw new J;await this._saveSession(n.session),await this._notifyAllSubscribers("TOKEN_REFRESHED",n.session);const o={session:n.session,error:null};return this.refreshingDeferred.resolve(o),o}catch(n){if(this._debug(i,"error",n),w(n)){const a={session:null,error:n};return ft(n)||await this._removeSession(),(t=this.refreshingDeferred)===null||t===void 0||t.resolve(a),a}throw(s=this.refreshingDeferred)===null||s===void 0||s.reject(n),n}finally{this.refreshingDeferred=null,this._debug(i,"end")}}async _notifyAllSubscribers(e,t,s=!0){const i=`#_notifyAllSubscribers(${e})`;this._debug(i,"begin",t,`broadcast = ${s}`);try{this.broadcastChannel&&s&&this.broadcastChannel.postMessage({event:e,session:t});const n=[],a=Array.from(this.stateChangeEmitters.values()).map(async o=>{try{await o.callback(e,t)}catch(l){n.push(l)}});if(await Promise.all(a),n.length>0){for(let o=0;o<n.length;o+=1)console.error(n[o]);throw n[0]}}finally{this._debug(i,"end")}}async _saveSession(e){this._debug("#_saveSession()",e),this.suppressGetSessionWarning=!0;const t=Object.assign({},e),s=t.user&&t.user.__isUserNotAvailableProxy===!0;if(this.userStorage){!s&&t.user&&await ve(this.userStorage,this.storageKey+"-user",{user:t.user});const i=Object.assign({},t);delete i.user;const n=qs(i);await ve(this.storage,this.storageKey,n)}else{const i=qs(t);await ve(this.storage,this.storageKey,i)}}async _removeSession(){this._debug("#_removeSession()"),await G(this.storage,this.storageKey),await G(this.storage,this.storageKey+"-code-verifier"),await G(this.storage,this.storageKey+"-user"),this.userStorage&&await G(this.userStorage,this.storageKey+"-user"),await this._notifyAllSubscribers("SIGNED_OUT",null)}_removeVisibilityChangedCallback(){this._debug("#_removeVisibilityChangedCallback()");const e=this.visibilityChangedCallback;this.visibilityChangedCallback=null;try{e&&L()&&window?.removeEventListener&&window.removeEventListener("visibilitychange",e)}catch(t){console.error("removing visibilitychange callback failed",t)}}async _startAutoRefresh(){await this._stopAutoRefresh(),this._debug("#_startAutoRefresh()");const e=setInterval(()=>this._autoRefreshTokenTick(),pe);this.autoRefreshTicker=e,e&&typeof e=="object"&&typeof e.unref=="function"?e.unref():typeof Deno<"u"&&typeof Deno.unrefTimer=="function"&&Deno.unrefTimer(e),setTimeout(async()=>{await this.initializePromise,await this._autoRefreshTokenTick()},0)}async _stopAutoRefresh(){this._debug("#_stopAutoRefresh()");const e=this.autoRefreshTicker;this.autoRefreshTicker=null,e&&clearInterval(e)}async startAutoRefresh(){this._removeVisibilityChangedCallback(),await this._startAutoRefresh()}async stopAutoRefresh(){this._removeVisibilityChangedCallback(),await this._stopAutoRefresh()}async _autoRefreshTokenTick(){this._debug("#_autoRefreshTokenTick()","begin");try{await this._acquireLock(0,async()=>{try{const e=Date.now();try{return await this._useSession(async t=>{const{data:{session:s}}=t;if(!s||!s.refresh_token||!s.expires_at){this._debug("#_autoRefreshTokenTick()","no session");return}const i=Math.floor((s.expires_at*1e3-e)/pe);this._debug("#_autoRefreshTokenTick()",`access token expires in ${i} ticks, a tick lasts ${pe}ms, refresh threshold is ${St} ticks`),i<=St&&await this._callRefreshToken(s.refresh_token)})}catch(t){console.error("Auto refresh tick failed with error. This is likely a transient error.",t)}}finally{this._debug("#_autoRefreshTokenTick()","end")}})}catch(e){if(e.isAcquireTimeout||e instanceof jr)this._debug("auto refresh token tick lock not available");else throw e}}async _handleVisibilityChange(){if(this._debug("#_handleVisibilityChange()"),!L()||!window?.addEventListener)return this.autoRefreshToken&&this.startAutoRefresh(),!1;try{this.visibilityChangedCallback=async()=>await this._onVisibilityChanged(!1),window?.addEventListener("visibilitychange",this.visibilityChangedCallback),await this._onVisibilityChanged(!0)}catch(e){console.error("_handleVisibilityChange",e)}}async _onVisibilityChanged(e){const t=`#_onVisibilityChanged(${e})`;this._debug(t,"visibilityState",document.visibilityState),document.visibilityState==="visible"?(this.autoRefreshToken&&this._startAutoRefresh(),e||(await this.initializePromise,await this._acquireLock(-1,async()=>{if(document.visibilityState!=="visible"){this._debug(t,"acquired the lock to recover the session, but the browser visibilityState is no longer visible, aborting");return}await this._recoverAndRefresh()}))):document.visibilityState==="hidden"&&this.autoRefreshToken&&this._stopAutoRefresh()}async _getUrlForProvider(e,t,s){const i=[`provider=${encodeURIComponent(t)}`];if(s?.redirectTo&&i.push(`redirect_to=${encodeURIComponent(s.redirectTo)}`),s?.scopes&&i.push(`scopes=${encodeURIComponent(s.scopes)}`),this.flowType==="pkce"){const[n,a]=await de(this.storage,this.storageKey),o=new URLSearchParams({code_challenge:`${encodeURIComponent(n)}`,code_challenge_method:`${encodeURIComponent(a)}`});i.push(o.toString())}if(s?.queryParams){const n=new URLSearchParams(s.queryParams);i.push(n.toString())}return s?.skipBrowserRedirect&&i.push(`skip_http_redirect=${s.skipBrowserRedirect}`),`${e}?${i.join("&")}`}async _unenroll(e){try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await k(this.fetch,"DELETE",`${this.url}/factors/${e.factorId}`,{headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _enroll(e){try{return await this._useSession(async t=>{var s,i;const{data:n,error:a}=t;if(a)return{data:null,error:a};const o=Object.assign({friendly_name:e.friendlyName,factor_type:e.factorType},e.factorType==="phone"?{phone:e.phone}:{issuer:e.issuer}),{data:l,error:u}=await k(this.fetch,"POST",`${this.url}/factors`,{body:o,headers:this.headers,jwt:(s=n?.session)===null||s===void 0?void 0:s.access_token});return u?{data:null,error:u}:(e.factorType==="totp"&&(!((i=l?.totp)===null||i===void 0)&&i.qr_code)&&(l.totp.qr_code=`data:image/svg+xml;utf-8,${l.totp.qr_code}`),{data:l,error:null})})}catch(t){if(w(t))return{data:null,error:t};throw t}}async _verify(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;if(n)return{data:null,error:n};const{data:a,error:o}=await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/verify`,{body:{code:e.code,challenge_id:e.challengeId},headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token});return o?{data:null,error:o}:(await this._saveSession(Object.assign({expires_at:Math.round(Date.now()/1e3)+a.expires_in},a)),await this._notifyAllSubscribers("MFA_CHALLENGE_VERIFIED",a),{data:a,error:o})})}catch(t){if(w(t))return{data:null,error:t};throw t}})}async _challenge(e){return this._acquireLock(-1,async()=>{try{return await this._useSession(async t=>{var s;const{data:i,error:n}=t;return n?{data:null,error:n}:await k(this.fetch,"POST",`${this.url}/factors/${e.factorId}/challenge`,{body:{channel:e.channel},headers:this.headers,jwt:(s=i?.session)===null||s===void 0?void 0:s.access_token})})}catch(t){if(w(t))return{data:null,error:t};throw t}})}async _challengeAndVerify(e){const{data:t,error:s}=await this._challenge({factorId:e.factorId});return s?{data:null,error:s}:await this._verify({factorId:e.factorId,challengeId:t.id,code:e.code})}async _listFactors(){const{data:{user:e},error:t}=await this.getUser();if(t)return{data:null,error:t};const s=e?.factors||[],i=s.filter(a=>a.factor_type==="totp"&&a.status==="verified"),n=s.filter(a=>a.factor_type==="phone"&&a.status==="verified");return{data:{all:s,totp:i,phone:n},error:null}}async _getAuthenticatorAssuranceLevel(){return this._acquireLock(-1,async()=>await this._useSession(async e=>{var t,s;const{data:{session:i},error:n}=e;if(n)return{data:null,error:n};if(!i)return{data:{currentLevel:null,nextLevel:null,currentAuthenticationMethods:[]},error:null};const{payload:a}=gt(i.access_token);let o=null;a.aal&&(o=a.aal);let l=o;((s=(t=i.user.factors)===null||t===void 0?void 0:t.filter(c=>c.status==="verified"))!==null&&s!==void 0?s:[]).length>0&&(l="aal2");const d=a.amr||[];return{data:{currentLevel:o,nextLevel:l,currentAuthenticationMethods:d},error:null}}))}async fetchJwk(e,t={keys:[]}){let s=t.keys.find(o=>o.kid===e);if(s)return s;const i=Date.now();if(s=this.jwks.keys.find(o=>o.kid===e),s&&this.jwks_cached_at+An>i)return s;const{data:n,error:a}=await k(this.fetch,"GET",`${this.url}/.well-known/jwks.json`,{headers:this.headers});if(a)throw a;return!n.keys||n.keys.length===0||(this.jwks=n,this.jwks_cached_at=i,s=n.keys.find(o=>o.kid===e),!s)?null:s}async getClaims(e,t={}){try{let s=e;if(!s){const{data:h,error:p}=await this.getSession();if(p||!h.session)return{data:null,error:p};s=h.session.access_token}const{header:i,payload:n,signature:a,raw:{header:o,payload:l}}=gt(s);t?.allowExpired||ra(n.exp);const u=!i.alg||i.alg.startsWith("HS")||!i.kid||!("crypto"in globalThis&&"subtle"in globalThis.crypto)?null:await this.fetchJwk(i.kid,t?.keys?{keys:t.keys}:t?.jwks);if(!u){const{error:h}=await this.getUser(s);if(h)throw h;return{data:{claims:n,header:i,signature:a},error:null}}const d=ia(i.alg),c=await crypto.subtle.importKey("jwk",u,d,!0,["verify"]);if(!await crypto.subtle.verify(d,c,a,Wn(`${o}.${l}`)))throw new Ot("Invalid JWT signature");return{data:{claims:n,header:i,signature:a},error:null}}catch(s){if(w(s))return{data:null,error:s};throw s}}}qe.nextInstanceID=0;const wa=qe;class ba extends wa{constructor(e){super(e)}}var ka=function(r,e,t,s){function i(n){return n instanceof t?n:new t(function(a){a(n)})}return new(t||(t=Promise))(function(n,a){function o(d){try{u(s.next(d))}catch(c){a(c)}}function l(d){try{u(s.throw(d))}catch(c){a(c)}}function u(d){d.done?n(d.value):i(d.value).then(o,l)}u((s=s.apply(r,e||[])).next())})};class Sa{constructor(e,t,s){var i,n,a;if(this.supabaseUrl=e,this.supabaseKey=t,!e)throw new Error("supabaseUrl is required.");if(!t)throw new Error("supabaseKey is required.");const o=$n(e),l=new URL(o);this.realtimeUrl=new URL("realtime/v1",l),this.realtimeUrl.protocol=this.realtimeUrl.protocol.replace("http","ws"),this.authUrl=new URL("auth/v1",l),this.storageUrl=new URL("storage/v1",l),this.functionsUrl=new URL("functions/v1",l);const u=`sb-${l.hostname.split(".")[0]}-auth-token`,d={db:mn,realtime:bn,auth:Object.assign(Object.assign({},wn),{storageKey:u}),global:yn},c=Tn(s??{},d);this.storageKey=(i=c.auth.storageKey)!==null&&i!==void 0?i:"",this.headers=(n=c.global.headers)!==null&&n!==void 0?n:{},c.accessToken?(this.accessToken=c.accessToken,this.auth=new Proxy({},{get:(f,h)=>{throw new Error(`@supabase/supabase-js: Supabase Client is configured with the accessToken option, accessing supabase.auth.${String(h)} is not possible`)}})):this.auth=this._initSupabaseAuthClient((a=c.auth)!==null&&a!==void 0?a:{},this.headers,c.global.fetch),this.fetch=En(t,this._getAccessToken.bind(this),c.global.fetch),this.realtime=this._initRealtimeClient(Object.assign({headers:this.headers,accessToken:this._getAccessToken.bind(this)},c.realtime)),this.rest=new Bi(new URL("rest/v1",l).href,{headers:this.headers,schema:c.db.schema,fetch:this.fetch}),c.accessToken||this._listenForAuthEvents()}get functions(){return new Oi(this.functionsUrl.href,{headers:this.headers,customFetch:this.fetch})}get storage(){return new pn(this.storageUrl.href,this.headers,this.fetch)}from(e){return this.rest.from(e)}schema(e){return this.rest.schema(e)}rpc(e,t={},s={}){return this.rest.rpc(e,t,s)}channel(e,t={config:{}}){return this.realtime.channel(e,t)}getChannels(){return this.realtime.getChannels()}removeChannel(e){return this.realtime.removeChannel(e)}removeAllChannels(){return this.realtime.removeAllChannels()}_getAccessToken(){var e,t;return ka(this,void 0,void 0,function*(){if(this.accessToken)return yield this.accessToken();const{data:s}=yield this.auth.getSession();return(t=(e=s.session)===null||e===void 0?void 0:e.access_token)!==null&&t!==void 0?t:null})}_initSupabaseAuthClient({autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,storageKey:n,flowType:a,lock:o,debug:l},u,d){const c={Authorization:`Bearer ${this.supabaseKey}`,apikey:`${this.supabaseKey}`};return new ba({url:this.authUrl.href,headers:Object.assign(Object.assign({},c),u),storageKey:n,autoRefreshToken:e,persistSession:t,detectSessionInUrl:s,storage:i,flowType:a,lock:o,debug:l,fetch:d,hasCustomAuthorizationHeader:"Authorization"in this.headers})}_initRealtimeClient(e){return new tn(this.realtimeUrl.href,Object.assign(Object.assign({},e),{params:Object.assign({apikey:this.supabaseKey},e?.params)}))}_listenForAuthEvents(){return this.auth.onAuthStateChange((t,s)=>{this._handleTokenChanged(t,"CLIENT",s?.access_token)})}_handleTokenChanged(e,t,s){(e==="TOKEN_REFRESHED"||e==="SIGNED_IN")&&this.changedAccessToken!==s?this.changedAccessToken=s:e==="SIGNED_OUT"&&(this.realtime.setAuth(),t=="STORAGE"&&this.auth.signOut(),this.changedAccessToken=void 0)}}const Pa=(r,e,t)=>new Sa(r,e,t);function Ea(){if(typeof window<"u"||typeof process>"u"||process.version===void 0||process.version===null)return!1;const r=process.version.match(/^v(\d+)\./);return r?parseInt(r[1],10)<=18:!1}Ea()&&console.warn("⚠️  Node.js 18 and below are deprecated and will no longer be supported in future versions of @supabase/supabase-js. Please upgrade to Node.js 20 or later. For more information, visit: https://github.com/orgs/supabase/discussions/37217");const Oa="https://mvwxrtcqkshkdgjpupqi.supabase.co",$a="eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6Im12d3hydGNxa3Noa2RnanB1cHFpIiwicm9sZSI6ImFub24iLCJpYXQiOjE3MjcxNjg0ODEsImV4cCI6MjA0Mjc0NDQ4MX0.dlilGfvw-D3q1hV4OrJTUIO68kE7OJIqn7I1mxMMtv8",Nt=Pa(Oa,$a);async function Ta(){localStorage.setItem("auth_action","signup");const{data:r,error:e}=await Nt.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});e?console.error("Error signing in with Google:",e.message):r.url&&(window.location.href=r.url)}async function xa(){localStorage.setItem("auth_action","signin");const{data:r,error:e}=await Nt.auth.signInWithOAuth({provider:"google",options:{redirectTo:`${window.location.origin}/auth/callback`}});e?console.error("Error signing in with Google:",e.message):r.url&&(window.location.href=r.url)}async function ja(){const{data:r}=await Nt.auth.getUser();return r||void 0}window.signInWithGoogle=xa;window.signUpWithGoogle=Ta;window.getUser=ja;class Ca{constructor(){this.currentRoute=window.location.pathname}async init(){const t=await(await fetch("/routes/?all=1")).json();this.routes=t}navigate(e,t){history.replaceState({html:document.getElementById("main-content").innerHTML},""),history.pushState(null,"",t||e),this.currentRoute=t||e,htmx.swap("#main-content",this.routes[e],{swapStyle:"innerHTML",transition:!0}),window.scrollTo({top:0,behavior:"smooth"}),Ir().hide()}}class Ia{constructor(e){this.router=e}dashboard(){this.router.navigate("/dashboard/"),Ar.currentType="weekly"}expenditures(){this.router.navigate("/all-expenditures/")}categories(){this.router.navigate("/categories/")}category(e){this.router.navigate("/categories/category-name/",`/categories/${e}/`),document.getElementById("pageHeading").textContent=e}viewWeek(e,t){e!=-1&&(_t("week_id",e),this.router.navigate("viewWeekSkeleton",`/weeks/${e}/`),document.getElementById("pageHeading").textContent=`${t}`)}viewDay(e,t){_t("date",e),_t("seeDay","1"),this.router.navigate("seeDaySkeleton",`/days/${e}/`),document.getElementById("pageHeading").textContent=t}weeks(){this.router.navigate("/weeks/"),document.getElementById("pageHeading").textContent="Weeks"}}const x=new Ca,Cr=new Ia(x);x.init();window.routes=Cr;let $t={};const _t=(r,e)=>{$t[r]=e};async function Ke(r){try{const e=await fetch(r);if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return await e.json()}catch(e){console.log("Error fetching data ",e)}}class Aa{constructor(){this.subscribers=[]}async fetchLatest(){const e=await Ke("/api/categories/");this.notifySubscribers(e)}subscribe(e){this.subscribers.push(e)}unsubscribe(e){this.subscribers=this.subscribers.filter(t=>t!=e)}notifySubscribers(e){this.subscribers.forEach(t=>{t.update(e)})}}const ke=new Aa,Ir=(()=>{let r;return()=>r||(r=window.FlowbiteInstances._instances.Drawer["separator-sidebar"],r)})();function Ra(r){return window.FlowbiteInstances._instances.Dropdown[r]}function Da(){return decodeURIComponent(window.location.pathname.split("/").filter(r=>r!=="").pop())}function La(){const r={...$t};return $t={},/^\/categories\/[^\/]+\/$/.test(x.currentRoute)?{categoryName:Da(),oneCategory:1,...r}:r}class Ua{constructor(){this.currentType="weekly"}fetch(e){e!=this.currentType&&(this.currentType=e,document.getElementById("statSummary").outerHTML=x.routes["/statSummarySkeleton/"],htmx.ajax("GET","/components/statSummary/?type="+e,{target:"#statSummarySkeleton",swap:"outerHTML"}))}}const Ar=new Ua;window.getAdditionalParams=La;window.statSummary=Ar;window.getDropdown=Ra;(function(){let r;document.addEventListener("alpine:init",()=>{se.data("toast",()=>({open:!0,autoDismiss:r,show(){this.autoDismiss&&setTimeout(()=>{this.open=!1},2e3)}}))})})();class Ma{constructor(){this.instances={}}getInstance(e){return this.instances[e]}setInstance(e,t){this.instances[e]=t}}const at=new Ma;class Fa{constructor(){this.instances={}}getInstance(e){return this.instances[e]}setInstance(e,t){this.instances[e]=t}}const qt=new Fa;(function(){document.addEventListener("alpine:init",()=>{se.data("themeToggler",()=>({dark:localStorage.getItem("dark")=="true",toggle(){this.dark=!this.dark,document.documentElement.classList.toggle("dark",this.dark),localStorage.setItem("dark",this.dark?"true":"false"),document.documentElement.setAttribute("data-theme",this.dark?"dark":"light")}}))})})();class Ba{constructor(){this.modals={},this.currentlyOpenModal=null}createModal(e,t){this.modals[e]=t}getModal(e){return this.modals[e]}}const We=new Ba;class H{constructor(e){this.modal=We.getModal(e)}open(){this.modal.open()}close(){this.modal.close()}}class Na extends H{_showPageSkeleton(e){return/^\/categories\/[^\/]+\/$/.test(e)?document.getElementById("see-products").outerHTML=x.routes.seeProductsSkeleton:!(e in x.routes)||e=="/search/"?this._navigateToDashboard():document.getElementById("main-content").innerHTML=x.routes[e]}_getHTMXTarget(e){return/^\/categories\/[^\/]+\/$/.test(e)?"#see-products":e=="/all-expenditures/"?"#all-expenditures":"#main-content"}_navigateToDashboard(){document.getElementById("main-content").innerHTML=x.routes["/dashboard/"],history.pushState(null,"","/dashboard/"),x.currentRoute="/dashboard/"}_resetFormUI(e){e.reset(),at.getInstance("categories-add-product").select(at.getInstance("categories-add-product").none),qt.getInstance("add-product-date").setToday()}_submitProductForm(e,t){const s=htmx.values(e);htmx.ajax("POST","/implementations/dashboard/",{values:s,target:t}).then(()=>{ke.fetchLatest()})}submitForm(){const e=document.getElementById("add-product-form");if(e.checkValidity()){const t=window.location.pathname,s=this._getHTMXTarget(t);this._showPageSkeleton(t),this.close(),this._submitProductForm(e,s),this._resetFormUI(e)}else e.reportValidity()}}class qa extends H{submitForm(){const e=document.getElementById("add-category-form");if(e.checkValidity()){document.getElementById("main-content").innerHTML=x.routes[x.currentRoute],this.close();const t=htmx.values(e);htmx.ajax("POST","/implementations/categories/",{values:t,target:"#main-content"}).then(()=>{ke.fetchLatest()}),e.reset()}else e.reportValidity()}}class Wa extends H{constructor(e,t){super(e),this.ff=t}setDetails(e){const t=JSON.parse(e),s=this.ff.formFields;s.name.value=t.name,s.description.value=t.description?t.description:"",s.id.value=t.id.toString(),this.open()}submitForm(){const e=document.getElementById("edit-category-form");if(e.checkValidity()){document.getElementById("main-content").innerHTML=x.routes[x.currentRoute],this.close();const t=htmx.values(e);htmx.ajax("POST","/implementations/categories/?edit=1",{values:t,target:"#main-content"}).then(()=>{ke.fetchLatest()}),e.reset()}else e.reportValidity()}}class za extends H{constructor(e,t,s){super(e),this.df=t,this.ff=s}setDetails(e){const t=JSON.parse(e),s=this.df.dataFields,i=this.ff.formFields;s.name.textContent=t.name,i.id.value=t.id.toString(),this.open()}submitForm(){const e=document.getElementById("delete-category-form");document.getElementById("main-content").innerHTML=x.routes[x.currentRoute];const t=htmx.values(e);this.close(),htmx.ajax("POST","/implementations/categories/?delete=1",{values:t,target:"#main-content"}).then(()=>{ke.fetchLatest()})}}class lt{constructor(){this.dataFields={}}setDataField(e,t){this.dataFields[e]=t}}class Ve{constructor(){this.formFields={}}setFormField(e,t){this.formFields[e]=t}}class Ha extends H{constructor(e,t){super(e),this.df=t}setDetails(e){const t=JSON.parse(e),s=this.df.dataFields;s.name.textContent=t.name,s.price.textContent=`GHS ${t.price.toFixed(2)}`,s.category.textContent=t.category?t.category.name:"None",s.description.textContent=t.description||"No description",this.open()}}class Ga extends H{constructor(e,t,s){super(e),this.df=t,this.ff=s}setDetails(e){const t=JSON.parse(e),s=this.df.dataFields,i=this.ff.formFields;s.name.textContent=t.name,s.price.textContent=`GHS ${t.price.toFixed(2)}`,s.category.textContent=t.category?t.category.name:"None",s.description.textContent=t.description||"No description",i.id.value=t.id.toString(),i.date.value=t.date,this.open()}submitForm(){const e=document.getElementById("delete-product-form"),t=htmx.values(e),s=htmx.find(`#product-${t.id}`),i=htmx.closest(s,".record");i.querySelector(".skeleton").classList.remove("hidden"),this.close(),htmx.ajax("POST","/implementations/dashboard/?delete=1",{values:t,target:i,swap:"outerHTML"})}}class Ja extends H{constructor(e,t){super(e),this.ff=t}setDetails(e){const t=JSON.parse(e),s=this.ff.formFields,i=t.price.toString().split(".");s.name.value=t.name,s.cedis.value=i[0],console.log(i),t.category&&(s.category.value=t.category.id.toString()),i.length==2?s.pesewas.value=i[1].length==2?i[1]:i[1]+"0":s.pesewas.value="00",s.id.value=t.id.toString(),s.description.value=t.description,s.date.value=t.date,this.setCategory(t.category),qt.getInstance("edit-product-date").setDate(t.date),this.open()}setCategory(e){const t=at.getInstance("categories-edit-product");e?t.select(e):t.select({id:null,name:"None"})}submitForm(){const e=document.getElementById("edit-product-form");if(e.checkValidity()){const t=htmx.values(e),s=htmx.find(`#product-${t.id}`),i=htmx.closest(s,".record");i.querySelector(".skeleton").classList.remove("hidden"),this.close(),htmx.ajax("POST","/implementations/dashboard/?edit=1",{values:t,target:i,swap:"outerHTML"}).then(()=>{ke.fetchLatest()})}else e.reportValidity()}}class Ka extends H{constructor(e,t){super(e),this.df=t}setDetails(e){const t=JSON.parse(e),s=this.df.dataFields;s.name.textContent=t.name,s.product_count.textContent=t.product_count.toString(),s.description.textContent=t.description||"No description",this.open()}}class Va extends H{constructor(e,t){super(e),this.ff=t}async submitForm(){const e=document.getElementById("search-form");if(e.checkValidity()){this.close(),x.navigate("/search/");const t=htmx.values(e);htmx.ajax("GET","/components/search/",{values:t,target:"#main-content"}),e.reset()}else e.reportValidity()}}const Qa=(()=>{let r;return()=>{if(r)return r;const e=new Ve;return r=new Va("search-modal",e),r}})(),Xa=(()=>{let r;return()=>r||(r=new Na("add-product-modal"),r)})(),Ya=(()=>{let r;return()=>r||(r=new qa("add-category-modal"),r)})(),Za=(()=>{let r;return()=>{if(r)return r;const e=new lt,t=new Ve;return r=new Ga("delete-product-modal",e,t),r}})(),eo=(()=>{let r;return()=>{if(r)return r;const e=new lt;return r=new Ha("show-details-modal",e),r}})(),to=(()=>{let r;return()=>{if(r)return r;const e=new Ve;return r=new Ja("edit-product-modal",e),r}})(),so=(()=>{let r;return()=>{if(r)return r;const e=new lt;return r=new Ka("category-details-modal",e),r}})(),ro=(()=>{let r;return()=>{if(r)return r;const e=new lt,t=new Ve;return r=new za("delete-category-modal",e,t),r}})(),io=(()=>{let r;return()=>{if(r)return r;const e=new Ve;return r=new Wa("edit-category-modal",e),r}})();function Wt(){localStorage.getItem("modalOpen")?(localStorage.removeItem("modalOpen"),localStorage.setItem("forwarded","true"),history.forward()):localStorage.getItem("forwarded")&&We.currentlyOpenModal.close()}window.getAddProductModal=Xa;window.getDeleteProductModal=Za;window.getShowDetailsModal=eo;window.getEditProductModal=to;window.getCategoryDetailsModal=so;window.getAddCategoryModal=Ya;window.getDeleteCategoryModal=ro;window.getEditCategoryModal=io;window.getSearchModal=Qa;window.handleCloseModal=Wt;window.modalManager=We;class Qe extends vi{createRenderRoot(){return this}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const Xe=r=>(e,t)=>{t!==void 0?t.addInitializer(()=>{customElements.define(r,e)}):customElements.define(r,e)};/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const no={attribute:!0,type:String,converter:yi,reflect:!1,hasChanged:_i},ao=(r=no,e,t)=>{const{kind:s,metadata:i}=t;let n=globalThis.litPropertyMetadata.get(i);if(n===void 0&&globalThis.litPropertyMetadata.set(i,n=new Map),s==="setter"&&((r=Object.create(r)).wrapped=!0),n.set(t.name,r),s==="accessor"){const{name:a}=t;return{set(o){const l=e.get.call(this);e.set.call(this,o),this.requestUpdate(a,l,r)},init(o){return o!==void 0&&this.C(a,void 0,r,o),o}}}if(s==="setter"){const{name:a}=t;return function(o){const l=this[a];e.call(this,o),this.requestUpdate(a,l,r)}}throw Error("Unsupported decorator location: "+s)};function A(r){return(e,t)=>typeof t=="object"?ao(r,e,t):((s,i,n)=>{const a=i.hasOwnProperty(n);return i.constructor.createProperty(n,s),a?Object.getOwnPropertyDescriptor(i,n):void 0})(r,e,t)}/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oo={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor","stroke-width":2,"stroke-linecap":"round","stroke-linejoin":"round"};/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rr=([r,e,t])=>{const s=document.createElementNS("http://www.w3.org/2000/svg",r);return Object.keys(e).forEach(i=>{s.setAttribute(i,String(e[i]))}),t?.length&&t.forEach(i=>{const n=Rr(i);s.appendChild(n)}),s},Dr=(r,e={})=>{const t="svg",s={...oo,...e};return Rr([t,s,r])};/**
 * @license lucide v0.525.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lr=[["path",{d:"M12 2v4"}],["path",{d:"m16.2 7.8 2.9-2.9"}],["path",{d:"M18 12h4"}],["path",{d:"m16.2 16.2 2.9 2.9"}],["path",{d:"M12 18v4"}],["path",{d:"m4.9 19.1 2.9-2.9"}],["path",{d:"M2 12h4"}],["path",{d:"m4.9 4.9 2.9 2.9"}]];/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */const co={CHILD:2},lo=r=>(...e)=>({_$litDirective$:r,values:e});class uo{constructor(e){}get _$AU(){return this._$AM._$AU}_$AT(e,t,s){this._$Ct=e,this._$AM=t,this._$Ci=s}_$AS(e,t){return this.update(e,t)}update(e,t){return this.render(...t)}}/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class Tt extends uo{constructor(e){if(super(e),this.it=ys,e.type!==co.CHILD)throw Error(this.constructor.directiveName+"() can only be used in child bindings")}render(e){if(e===ys||e==null)return this._t=void 0,this.it=e;if(e===mi)return e;if(typeof e!="string")throw Error(this.constructor.directiveName+"() called with a non-string value");if(e===this.it)return this._t;this.it=e;const t=[e];return t.raw=t,this._t={_$litType$:this.constructor.resultType,strings:t,values:[]}}}Tt.directiveName="unsafeHTML",Tt.resultType=1;/**
 * @license
 * Copyright 2017 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */class xt extends Tt{}xt.directiveName="unsafeSVG",xt.resultType=2;const Ur=lo(xt);var ho=Object.create,zt=Object.defineProperty,fo=Object.getOwnPropertyDescriptor,Mr=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Se=r=>{throw TypeError(r)},go=(r,e,t)=>e in r?zt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Js=(r,e)=>zt(r,"name",{value:e,configurable:!0}),po=r=>[,,,ho(r?.[Mr("metadata")]??null)],Fr=["class","method","getter","setter","accessor","field","value","get","set"],Ae=r=>r!==void 0&&typeof r!="function"?Se("Function expected"):r,vo=(r,e,t,s,i)=>({kind:Fr[r],name:e,metadata:s,addInitializer:n=>t._?Se("Already initialized"):i.push(Ae(n||null))}),_o=(r,e)=>go(e,Mr("metadata"),r[3]),Re=(r,e,t,s)=>{for(var i=0,n=r[e>>1],a=n&&n.length;i<a;i++)e&1?n[i].call(t):s=n[i].call(t,s);return s},Ht=(r,e,t,s,i,n)=>{var a,o,l,u,d,c=e&7,f=!!(e&8),h=!!(e&16),p=c>3?r.length+1:c?f?1:2:0,m=Fr[c+5],y=c>3&&(r[p-1]=[]),S=r[p]||(r[p]=[]),v=c&&(!h&&!f&&(i=i.prototype),c<5&&(c>3||!h)&&fo(c<4?i:{get[t](){return Ks(this,n)},set[t](g){return Qs(this,n,g)}},t));c?h&&c<4&&Js(n,(c>2?"set ":c>1?"get ":"")+t):Js(i,t);for(var _=s.length-1;_>=0;_--)u=vo(c,t,l={},r[3],S),c&&(u.static=f,u.private=h,d=u.access={has:h?g=>yo(i,g):g=>t in g},c^3&&(d.get=h?g=>(c^1?Ks:mo)(g,i,c^4?n:v.get):g=>g[t]),c>2&&(d.set=h?(g,b)=>Qs(g,i,b,c^4?n:v.set):(g,b)=>g[t]=b)),o=(0,s[_])(c?c<4?h?n:v[m]:c>4?void 0:{get:v.get,set:v.set}:i,u),l._=1,c^4||o===void 0?Ae(o)&&(c>4?y.unshift(o):c?h?n=o:v[m]=o:i=o):typeof o!="object"||o===null?Se("Object expected"):(Ae(a=o.get)&&(v.get=a),Ae(a=o.set)&&(v.set=a),Ae(a=o.init)&&y.unshift(a));return c||_o(r,i),v&&zt(i,t,v),h?c^4?n:v:i},Gt=(r,e,t)=>e.has(r)||Se("Cannot "+t),yo=(r,e)=>Object(e)!==e?Se('Cannot use the "in" operator on this value'):r.has(e),Ks=(r,e,t)=>(Gt(r,e,"read from private field"),t?t.call(r):e.get(r)),Vs=(r,e,t)=>e.has(r)?Se("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),Qs=(r,e,t,s)=>(Gt(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),mo=(r,e,t)=>(Gt(r,e,"access private method"),t),Br,Nr,jt,qr,W,Jt,Kt;const _e={data:void 0,useCachedData:!1};qr=[Xe("weeks-chart")];class ze extends(jt=Qe,Nr=[A({type:Array})],Br=[A({type:Boolean})],jt){constructor(){super(...arguments),Vs(this,Jt,Re(W,8,this,[])),Re(W,11,this),Vs(this,Kt,Re(W,12,this,!1)),Re(W,15,this),this.chart=null,this.observer=null}tooltipFormatter(e,{dataPointIndex:t}){return this.data.map(i=>`${i.week_start} - ${i.week_end}`)[t]}getToolTipOptions(){return{theme:this.getisDark()?"dark":"light",style:{fontFamily:"Poppins-Regular"},x:{formatter:this.tooltipFormatter.bind(this)}}}getLabelsStyleOptions(){return{colors:this.getisDark()?"#9ca3af":"#1f2937",fontFamily:"Poppins-Regular"}}getGridOptions(){return{borderColor:this.getisDark()?"#f3f4f60d":"#e5e7eb"}}getisDark(){return document.documentElement.classList.contains("dark")}getXaxisOptions(){return{labels:{style:this.getLabelsStyleOptions()},axisBorder:{color:this.getisDark()?"#f3f4f60d":"#e5e7eb"},axisTicks:{color:this.getisDark()?"#f3f4f60d":"#e5e7eb"}}}getYaxisOptions(){return{labels:{style:this.getLabelsStyleOptions()}}}renderChart(){const e={chart:{type:"line",toolbar:{show:!1},zoom:{enabled:!1}},grid:this.getGridOptions(),stroke:{curve:"smooth",width:1},markers:{size:5,strokeWidth:0,hover:{size:7}},series:[{name:"Weekly Spendings",data:this.data.map(s=>s.total_amount)}],xaxis:this.getXaxisOptions(),yaxis:this.getYaxisOptions(),tooltip:this.getToolTipOptions()},t=this.querySelector("#chart");t&&(this.chart=new ur(t,e),this.chart.render())}updateColors(){this.chart&&this.chart.updateOptions({xaxis:this.getXaxisOptions(),yaxis:this.getYaxisOptions(),tooltip:this.getToolTipOptions(),grid:this.getGridOptions()})}async fetchData(){if(_e.useCachedData&&_e.data)this.data=_e.data,_e.useCachedData=!1;else{const e=await Ke("/api/weekly-spendings/?limit=10");this.data=e.weekly_spendings.sort((t,s)=>new Date(t.week_start).getTime()-new Date(s.week_start).getTime()),_e.data=this.data}this.chart.updateSeries([{name:"Weekly Spendings",data:this.data.map(e=>e.total_amount)}]),this.ready=!0}firstUpdated(){this.ready=!1,this.renderChart(),this.fetchData(),this.observer=new MutationObserver(()=>{this.updateColors()}),this.observer.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})}disconnectedCallback(){super.disconnectedCallback(),this.observer&&this.observer.disconnect(),this.chart&&this.chart.destroy()}render(){const e=Dr(Lr,{color:"#888",size:40,class:"lucide lucide-loader animate-spin stroke-blue-500"}).outerHTML;return D`
    <div style="position:relative;">
        ${this.ready?null:D`
          <div style="
            position:absolute;
            inset:0;
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:10;
          ">
            ${dr`${Ur(e)}`}
          </div>
        `}
        <div id="chart"></div>
    </div>
    `}}W=po(jt);Jt=new WeakMap;Kt=new WeakMap;Ht(W,4,"data",Nr,ze,Jt);Ht(W,4,"ready",Br,ze,Kt);ze=Ht(W,0,"WeeksChart",qr,ze);Re(W,1,ze);var wo=Object.create,Vt=Object.defineProperty,bo=Object.getOwnPropertyDescriptor,Wr=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Pe=r=>{throw TypeError(r)},ko=(r,e,t)=>e in r?Vt(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,Xs=(r,e)=>Vt(r,"name",{value:e,configurable:!0}),So=r=>[,,,wo(r?.[Wr("metadata")]??null)],zr=["class","method","getter","setter","accessor","field","value","get","set"],De=r=>r!==void 0&&typeof r!="function"?Pe("Function expected"):r,Po=(r,e,t,s,i)=>({kind:zr[r],name:e,metadata:s,addInitializer:n=>t._?Pe("Already initialized"):i.push(De(n||null))}),Eo=(r,e)=>ko(e,Wr("metadata"),r[3]),Le=(r,e,t,s)=>{for(var i=0,n=r[e>>1],a=n&&n.length;i<a;i++)e&1?n[i].call(t):s=n[i].call(t,s);return s},Qt=(r,e,t,s,i,n)=>{var a,o,l,u,d,c=e&7,f=!!(e&8),h=!!(e&16),p=c>3?r.length+1:c?f?1:2:0,m=zr[c+5],y=c>3&&(r[p-1]=[]),S=r[p]||(r[p]=[]),v=c&&(!h&&!f&&(i=i.prototype),c<5&&(c>3||!h)&&bo(c<4?i:{get[t](){return Ys(this,n)},set[t](g){return er(this,n,g)}},t));c?h&&c<4&&Xs(n,(c>2?"set ":c>1?"get ":"")+t):Xs(i,t);for(var _=s.length-1;_>=0;_--)u=Po(c,t,l={},r[3],S),c&&(u.static=f,u.private=h,d=u.access={has:h?g=>Oo(i,g):g=>t in g},c^3&&(d.get=h?g=>(c^1?Ys:$o)(g,i,c^4?n:v.get):g=>g[t]),c>2&&(d.set=h?(g,b)=>er(g,i,b,c^4?n:v.set):(g,b)=>g[t]=b)),o=(0,s[_])(c?c<4?h?n:v[m]:c>4?void 0:{get:v.get,set:v.set}:i,u),l._=1,c^4||o===void 0?De(o)&&(c>4?y.unshift(o):c?h?n=o:v[m]=o:i=o):typeof o!="object"||o===null?Pe("Object expected"):(De(a=o.get)&&(v.get=a),De(a=o.set)&&(v.set=a),De(a=o.init)&&y.unshift(a));return c||Eo(r,i),v&&Vt(i,t,v),h?c^4?n:v:i},Xt=(r,e,t)=>e.has(r)||Pe("Cannot "+t),Oo=(r,e)=>Object(e)!==e?Pe('Cannot use the "in" operator on this value'):r.has(e),Ys=(r,e,t)=>(Xt(r,e,"read from private field"),t?t.call(r):e.get(r)),Zs=(r,e,t)=>e.has(r)?Pe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),er=(r,e,t,s)=>(Xt(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),$o=(r,e,t)=>(Xt(r,e,"access private method"),t),Hr,Gr,Ct,Jr,z,Yt,Zt;const ye={data:void 0,useCachedData:!1};Jr=[Xe("months-chart")];class He extends(Ct=Qe,Gr=[A({type:Array})],Hr=[A({type:Boolean})],Ct){constructor(){super(...arguments),Zs(this,Yt,Le(z,8,this,[])),Le(z,11,this),Zs(this,Zt,Le(z,12,this,!1)),Le(z,15,this),this.chart=null,this.observer=null}tooltipFormatter(e,{dataPointIndex:t}){return this.data.map(i=>`${i.month_start} - ${i.month_end}`)[t]}getToolTipOptions(){return{theme:this.getisDark()?"dark":"light",style:{fontFamily:"Poppins-Regular"},x:{formatter:this.tooltipFormatter.bind(this)}}}getLabelsStyleOptions(){return{colors:this.getisDark()?"#9ca3af":"#1f2937",fontFamily:"Poppins-Regular"}}getGridOptions(){return{borderColor:this.getisDark()?"#f3f4f60d":"#e5e7eb"}}getisDark(){return document.documentElement.classList.contains("dark")}getXaxisOptions(){return{labels:{style:this.getLabelsStyleOptions()},axisBorder:{color:this.getisDark()?"#f3f4f60d":"#e5e7eb"},axisTicks:{color:this.getisDark()?"#f3f4f60d":"#e5e7eb"}}}getYaxisOptions(){return{labels:{style:this.getLabelsStyleOptions()}}}renderChart(){const e={chart:{type:"line",toolbar:{show:!1},zoom:{enabled:!1}},colors:["#f97316"],grid:this.getGridOptions(),stroke:{curve:"smooth",width:1},markers:{size:5,colors:["#f97316"],strokeWidth:0,hover:{size:7}},series:[{name:"Monthly Spendings",data:this.data.map(s=>s.total_amount)}],xaxis:this.getXaxisOptions(),yaxis:this.getYaxisOptions(),tooltip:this.getToolTipOptions()},t=this.querySelector("#chart");t&&(this.chart=new ur(t,e),this.chart.render())}updateColors(){this.chart&&this.chart.updateOptions({xaxis:this.getXaxisOptions(),yaxis:this.getYaxisOptions(),tooltip:this.getToolTipOptions(),grid:this.getGridOptions()})}async fetchData(){if(ye.useCachedData&&ye.data)this.data=ye.data,ye.useCachedData=!1;else{const e=await Ke("/api/monthly-spendings/?limit=10");this.data=e.monthly_spendings.sort((t,s)=>new Date(t.month_start).getTime()-new Date(s.month_start).getTime()),ye.data=this.data}this.chart.updateSeries([{name:"Monthly Spendings",data:this.data.map(e=>e.total_amount)}]),this.ready=!0}firstUpdated(){this.ready=!1,this.renderChart(),this.fetchData(),this.observer=new MutationObserver(()=>{this.updateColors()}),this.observer.observe(document.documentElement,{attributes:!0,attributeFilter:["class"]})}disconnectedCallback(){super.disconnectedCallback(),this.observer&&this.observer.disconnect(),this.chart&&this.chart.destroy()}render(){const e=Dr(Lr,{color:"#888",size:40,class:"lucide lucide-loader animate-spin stroke-blue-500"}).outerHTML;return D`
    <div style="position:relative;">
        ${this.ready?null:D`
          <div style="
            position:absolute;
            inset:0;
            display:flex;
            align-items:center;
            justify-content:center;
            z-index:10;
          ">
            ${dr`${Ur(e)}`}
          </div>
        `}
        <div id="chart"></div>
    </div>
    `}}z=So(Ct);Yt=new WeakMap;Zt=new WeakMap;Qt(z,4,"data",Gr,He,Yt);Qt(z,4,"ready",Hr,He,Zt);He=Qt(z,0,"MonthsChart",Jr,He);Le(z,1,He);var To=Object.create,es=Object.defineProperty,xo=Object.getOwnPropertyDescriptor,Kr=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Ee=r=>{throw TypeError(r)},jo=(r,e,t)=>e in r?es(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,tr=(r,e)=>es(r,"name",{value:e,configurable:!0}),Co=r=>[,,,To(r?.[Kr("metadata")]??null)],Vr=["class","method","getter","setter","accessor","field","value","get","set"],Ue=r=>r!==void 0&&typeof r!="function"?Ee("Function expected"):r,Io=(r,e,t,s,i)=>({kind:Vr[r],name:e,metadata:s,addInitializer:n=>t._?Ee("Already initialized"):i.push(Ue(n||null))}),Ao=(r,e)=>jo(e,Kr("metadata"),r[3]),N=(r,e,t,s)=>{for(var i=0,n=r[e>>1],a=n&&n.length;i<a;i++)e&1?n[i].call(t):s=n[i].call(t,s);return s},Ye=(r,e,t,s,i,n)=>{var a,o,l,u,d,c=e&7,f=!!(e&8),h=!!(e&16),p=c>3?r.length+1:c?f?1:2:0,m=Vr[c+5],y=c>3&&(r[p-1]=[]),S=r[p]||(r[p]=[]),v=c&&(!h&&!f&&(i=i.prototype),c<5&&(c>3||!h)&&xo(c<4?i:{get[t](){return sr(this,n)},set[t](g){return rr(this,n,g)}},t));c?h&&c<4&&tr(n,(c>2?"set ":c>1?"get ":"")+t):tr(i,t);for(var _=s.length-1;_>=0;_--)u=Io(c,t,l={},r[3],S),c&&(u.static=f,u.private=h,d=u.access={has:h?g=>Ro(i,g):g=>t in g},c^3&&(d.get=h?g=>(c^1?sr:Do)(g,i,c^4?n:v.get):g=>g[t]),c>2&&(d.set=h?(g,b)=>rr(g,i,b,c^4?n:v.set):(g,b)=>g[t]=b)),o=(0,s[_])(c?c<4?h?n:v[m]:c>4?void 0:{get:v.get,set:v.set}:i,u),l._=1,c^4||o===void 0?Ue(o)&&(c>4?y.unshift(o):c?h?n=o:v[m]=o:i=o):typeof o!="object"||o===null?Ee("Object expected"):(Ue(a=o.get)&&(v.get=a),Ue(a=o.set)&&(v.set=a),Ue(a=o.init)&&y.unshift(a));return c||Ao(r,i),v&&es(i,t,v),h?c^4?n:v:i},ts=(r,e,t)=>e.has(r)||Ee("Cannot "+t),Ro=(r,e)=>Object(e)!==e?Ee('Cannot use the "in" operator on this value'):r.has(e),sr=(r,e,t)=>(ts(r,e,"read from private field"),t?t.call(r):e.get(r)),rt=(r,e,t)=>e.has(r)?Ee("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),rr=(r,e,t,s)=>(ts(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),Do=(r,e,t)=>(ts(r,e,"access private method"),t),Qr,Xr,Yr,Zr,It,ei,C,ss,rs,is,ns;const F={data:void 0,currentPages:1,numberOfPages:1,useCachedData:!1};ei=[Xe("weeks-records")];class re extends(It=Qe,Zr=[A({type:Array})],Yr=[A({type:Boolean})],Xr=[A({type:Number})],Qr=[A({type:Number})],It){constructor(){super(...arguments),rt(this,ss,N(C,8,this,[])),N(C,11,this),rt(this,rs,N(C,12,this,!1)),N(C,15,this),rt(this,is,N(C,16,this,1)),N(C,19,this),rt(this,ns,N(C,20,this,1)),N(C,23,this)}nextPage(){this.currentPage<this.numberOfPages&&(this.ready=!1,this.currentPage++,this.fetchData())}prevPage(){this.currentPage>1&&(this.ready=!1,this.currentPage--,this.fetchData())}getPage(e){e>=1&&e<=this.numberOfPages&&e!==this.currentPage&&(this.ready=!1,this.currentPage=e,this.fetchData())}async fetchData(){if(F.useCachedData&&F.data)this.data=F.data,this.numberOfPages=F.numberOfPages,this.currentPage=F.currentPages,F.useCachedData=!1;else{const e=await Ke(`/api/weekly-spendings/?page=${this.currentPage}`);this.data=e.weekly_spendings,this.numberOfPages=e.number_of_pages,this.currentPage=e.current_page,F.data=this.data,F.numberOfPages=this.numberOfPages,F.currentPages=this.currentPage}this.ready=!0}populateData(e){return e.map(s=>D`
            <tr>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium text-gray-800 dark:text-neutral-200 link" 
                @click=${()=>Cr.viewWeek(s.id,`${s.week_start} - ${s.week_end}`)}                
                >    
                ${s.week_start} - ${s.week_end}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-gray-800 dark:text-neutral-200">
                    GHS ${s.total_amount}
                </td>
            </tr>
        `)}skeletonRows(e){const t=[];for(let s=0;s<e;s++)t.push(D`
                <tr>
                   <td class="px-6 py-4">
                      <div class="h-4 w-32 record-skeleton"></div>
                    </td>
                   <td class="px-6 py-4">
                      <div class="h-4 w-12 record-skeleton"></div>
                    </td>
                </tr>
            `);return t}connectedCallback(){super.connectedCallback(),this.fetchData()}render(){return D`
        <div class="p-4 bg-gray-50 dark:bg-dark2 dark:border-darkborder rounded-md border relative record">
            <h3 class="p-2  tracking-tight border-b dark:border-darkborder text-gray-900 dark:text-gray-300">
            <div class="flex items-center justify-between">
                <div class="text-xl font-bold">
                <!-- {{date|timesince}} -->
                </div>
            </div>   
            <div class="text-sm text-gray-500 dark:text-gray-400 font-medium my-2">
                <!-- {{ date | dateOnly}} -->
            </div>
            </h3>
        
    <div class="flex flex-col">
        <div class="-m-1.5 overflow-x-auto">
          <div class="p-1.5 min-w-full inline-block align-middle">
            <div class="overflow-hidden">
              <table class="min-w-full divide-y dark:divide-gray-100/5">
                <thead>
                  <tr>
                    <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Week</th>
                    <th scope="col" class="px-6 py-3 text-start text-xs font-medium text-gray-500 dark:text-gray-400 uppercase">Total</th>
                  </tr>
                </thead>
                <tbody class="divide-y dark:divide-gray-100/5">
                    ${this.ready?D`${this.populateData(this.data)}`:D`${this.skeletonRows(5)}`}
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
    </div>
    ${D`
      <weeks-records-paginator
      .nextFxn=${this.nextPage.bind(this)}
      .prevFxn=${this.prevPage.bind(this)}
      .getPageFxn=${this.getPage.bind(this)}
      .currentPage=${this.currentPage}
      .numberOfPages=${this.numberOfPages}
      >
      </weeks-records-paginator>`}
    `}}C=Co(It);ss=new WeakMap;rs=new WeakMap;is=new WeakMap;ns=new WeakMap;Ye(C,4,"data",Zr,re,ss);Ye(C,4,"ready",Yr,re,rs);Ye(C,4,"currentPage",Xr,re,is);Ye(C,4,"numberOfPages",Qr,re,ns);re=Ye(C,0,"WeeksRecords",ei,re);N(C,1,re);class Lo{constructor(){this.handlers={}}addHandler(e,t){this.handlers[e]?this.handlers[e].push(t):this.handlers[e]=[t]}handle(e,t){this.handlers[e]&&this.handlers[e].forEach(s=>s()),t.state&&e!="/weeks/"&&(document.getElementById("main-content").innerHTML=t.state.html)}}const as=new Lo;as.addHandler("/dashboard/",()=>{_e.useCachedData=!0,ye.useCachedData=!0});as.addHandler("/weeks/",()=>{F.useCachedData=!0,document.getElementById("main-content").innerHTML=x.routes["/weeks/"],document.getElementById("pageHeading").textContent="Weeks"});function Uo(r){return{isOpen:!1,init(){We.createModal(r,this)},open(){this.isOpen=!0,this.toggleSideEffects(!this.isOpen),history.pushState(null,""),localStorage.setItem("modalOpen","true"),We.currentlyOpenModal=this},close(){this.isOpen=!1,this.toggleSideEffects(!this.isOpen),localStorage.removeItem("modalOpen"),localStorage.removeItem("forwarded")},toggleSideEffects(e){const t=document.getElementById("animated-backdrop"),s=document.body;t.classList.toggle("hidden",e),s.classList.toggle("overflow-hidden",!e)},handleClickOutside(e){e.target==e.currentTarget&&this.close()}}}function Mo(r){return{isOpen:!1,filtered:[],items:[],isFocused:!1,selected:{},submitProperty:"",newSearch:"",newCategory:{},none:{id:null,name:"None"},async init(){at.setInstance(r,this),ke.subscribe(this);const e=await Ke("/api/categories/");this.update(e),this.selected=this.none},update(e){this.items=[this.none,...e],this.filtered=[...this.items]},open(){this.isOpen=!0,this.isFocused=!0},close(){this.isOpen=!1,this.selected={...this.selected},this.filtered=[...this.items],this.isFocused=!1},filter(e){const t=e.currentTarget.value.toLowerCase();this.filtered=this.items.filter(s=>s.name.toLowerCase().includes(t)),this.filtered.length==0?(this.newSearch=e.currentTarget.value,this.newCategory={id:0,name:this.newSearch},this.select(this.newCategory)):this.open()},select(e){this.selected=e,this.isOpen=!1,this.filtered=[...this.items]}}}function Fo(r){return{calendar:void 0,field:void 0,options:{inputMode:!0,positionToInput:"center",styles:{calendar:"calendar",dateBtn:"vc-date__btn date-btn",date:"vc-date",month:"",year:"",yearsYear:"vc-years__year",monthsMonth:"vc-months__month"},onClickDate(e,t){const s=e.context.selectedDates[0];if(s){document.getElementById(r+"-value").value=s;const i=new Date(s);document.getElementById(r).value=i.toDateString()}}},init(){qt.setInstance(r,this);const{Calendar:e}=window.VanillaCalendarPro;this.field=document.getElementById(r),this.calendar=new e(this.field,this.options),this.calendar.init(),this.setToday()},setDate(e){const t=new Date(e);this.field.value=t.toDateString();const s=t.toISOString().split("T")[0];document.getElementById(r+"-value").value=s,this.calendar.update()},setToday(){const e=new Date,t=e.toDateString();this.field.value=t,document.getElementById(r+"-value").value=e.toISOString().split("T")[0]}}}function ti(){se.data("baseModal",Uo),se.data("selectField",Mo),se.data("datePicker",Fo)}function os(){Ir().hide(),window.initFlowbite()}function si(r){const e=window.location.pathname;e in x.routes&&as.handle(e,r),os()}document.addEventListener("htmx:afterSettle",os);document.addEventListener("alpine:init",ti);window.addEventListener("popstate",Wt);window.addEventListener("popstate",si);window.addEventListener("beforeunload",()=>{document.removeEventListener("alpine:init",ti),window.removeEventListener("popstate",Wt),window.removeEventListener("popstate",si),document.addEventListener("htmx:afterSettle",os)});var Bo=Object.create,cs=Object.defineProperty,No=Object.getOwnPropertyDescriptor,ri=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),Oe=r=>{throw TypeError(r)},qo=(r,e,t)=>e in r?cs(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,ir=(r,e)=>cs(r,"name",{value:e,configurable:!0}),Wo=r=>[,,,Bo(r?.[ri("metadata")]??null)],ii=["class","method","getter","setter","accessor","field","value","get","set"],Me=r=>r!==void 0&&typeof r!="function"?Oe("Function expected"):r,zo=(r,e,t,s,i)=>({kind:ii[r],name:e,metadata:s,addInitializer:n=>t._?Oe("Already initialized"):i.push(Me(n||null))}),Ho=(r,e)=>qo(e,ri("metadata"),r[3]),At=(r,e,t,s)=>{for(var i=0,n=r[e>>1],a=n&&n.length;i<a;i++)e&1?n[i].call(t):s=n[i].call(t,s);return s},ni=(r,e,t,s,i,n)=>{var a,o,l,u,d,c=e&7,f=!!(e&8),h=!!(e&16),p=c>3?r.length+1:c?f?1:2:0,m=ii[c+5],y=c>3&&(r[p-1]=[]),S=r[p]||(r[p]=[]),v=c&&(!h&&!f&&(i=i.prototype),c<5&&(c>3||!h)&&No(c<4?i:{get[t](){return nr(this,n)},set[t](g){return ar(this,n,g)}},t));c?h&&c<4&&ir(n,(c>2?"set ":c>1?"get ":"")+t):ir(i,t);for(var _=s.length-1;_>=0;_--)u=zo(c,t,l={},r[3],S),c&&(u.static=f,u.private=h,d=u.access={has:h?g=>Go(i,g):g=>t in g},c^3&&(d.get=h?g=>(c^1?nr:Ko)(g,i,c^4?n:v.get):g=>g[t]),c>2&&(d.set=h?(g,b)=>ar(g,i,b,c^4?n:v.set):(g,b)=>g[t]=b)),o=(0,s[_])(c?c<4?h?n:v[m]:c>4?void 0:{get:v.get,set:v.set}:i,u),l._=1,c^4||o===void 0?Me(o)&&(c>4?y.unshift(o):c?h?n=o:v[m]=o:i=o):typeof o!="object"||o===null?Oe("Object expected"):(Me(a=o.get)&&(v.get=a),Me(a=o.set)&&(v.set=a),Me(a=o.init)&&y.unshift(a));return c||Ho(r,i),v&&cs(i,t,v),h?c^4?n:v:i},ls=(r,e,t)=>e.has(r)||Oe("Cannot "+t),Go=(r,e)=>Object(e)!==e?Oe('Cannot use the "in" operator on this value'):r.has(e),nr=(r,e,t)=>(ls(r,e,"read from private field"),t?t.call(r):e.get(r)),Jo=(r,e,t)=>e.has(r)?Oe("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),ar=(r,e,t,s)=>(ls(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),Ko=(r,e,t)=>(ls(r,e,"access private method"),t),ai,Rt,oi,we,us;oi=[Xe("my-button")];class ot extends(Rt=Qe,ai=[A({type:String})],Rt){constructor(){super(...arguments),Jo(this,us,At(we,8,this,"Click Me")),At(we,11,this)}render(){return D`<button><slot>${this.label}</slot></button>`}}we=Wo(Rt);us=new WeakMap;ni(we,4,"label",ai,ot,us);ot=ni(we,0,"MyButton",oi,ot);At(we,1,ot);/**
 * @license
 * Copyright 2021 Google LLC
 * SPDX-License-Identifier: BSD-3-Clause
 */function*Vo(r,e){if(r!==void 0){let t=0;for(const s of r)yield e(s,t++)}}var Qo=Object.create,ds=Object.defineProperty,Xo=Object.getOwnPropertyDescriptor,ci=(r,e)=>(e=Symbol[r])?e:Symbol.for("Symbol."+r),$e=r=>{throw TypeError(r)},Yo=(r,e,t)=>e in r?ds(r,e,{enumerable:!0,configurable:!0,writable:!0,value:t}):r[e]=t,or=(r,e)=>ds(r,"name",{value:e,configurable:!0}),Zo=r=>[,,,Qo(r?.[ci("metadata")]??null)],li=["class","method","getter","setter","accessor","field","value","get","set"],Fe=r=>r!==void 0&&typeof r!="function"?$e("Function expected"):r,ec=(r,e,t,s,i)=>({kind:li[r],name:e,metadata:s,addInitializer:n=>t._?$e("Already initialized"):i.push(Fe(n||null))}),tc=(r,e)=>Yo(e,ci("metadata"),r[3]),U=(r,e,t,s)=>{for(var i=0,n=r[e>>1],a=n&&n.length;i<a;i++)e&1?n[i].call(t):s=n[i].call(t,s);return s},Te=(r,e,t,s,i,n)=>{var a,o,l,u,d,c=e&7,f=!!(e&8),h=!!(e&16),p=c>3?r.length+1:c?f?1:2:0,m=li[c+5],y=c>3&&(r[p-1]=[]),S=r[p]||(r[p]=[]),v=c&&(!h&&!f&&(i=i.prototype),c<5&&(c>3||!h)&&Xo(c<4?i:{get[t](){return cr(this,n)},set[t](g){return lr(this,n,g)}},t));c?h&&c<4&&or(n,(c>2?"set ":c>1?"get ":"")+t):or(i,t);for(var _=s.length-1;_>=0;_--)u=ec(c,t,l={},r[3],S),c&&(u.static=f,u.private=h,d=u.access={has:h?g=>sc(i,g):g=>t in g},c^3&&(d.get=h?g=>(c^1?cr:rc)(g,i,c^4?n:v.get):g=>g[t]),c>2&&(d.set=h?(g,b)=>lr(g,i,b,c^4?n:v.set):(g,b)=>g[t]=b)),o=(0,s[_])(c?c<4?h?n:v[m]:c>4?void 0:{get:v.get,set:v.set}:i,u),l._=1,c^4||o===void 0?Fe(o)&&(c>4?y.unshift(o):c?h?n=o:v[m]=o:i=o):typeof o!="object"||o===null?$e("Object expected"):(Fe(a=o.get)&&(v.get=a),Fe(a=o.set)&&(v.set=a),Fe(a=o.init)&&y.unshift(a));return c||tc(r,i),v&&ds(i,t,v),h?c^4?n:v:i},hs=(r,e,t)=>e.has(r)||$e("Cannot "+t),sc=(r,e)=>Object(e)!==e?$e('Cannot use the "in" operator on this value'):r.has(e),cr=(r,e,t)=>(hs(r,e,"read from private field"),t?t.call(r):e.get(r)),Ce=(r,e,t)=>e.has(r)?$e("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(r):e.set(r,t),lr=(r,e,t,s)=>(hs(r,e,"write to private field"),s?s.call(r,t):e.set(r,t),t),rc=(r,e,t)=>(hs(r,e,"access private method"),t),ui,di,hi,fi,gi,Dt,pi,T,fs,gs,ps,vs,_s;pi=[Xe("weeks-records-paginator")];class Q extends(Dt=Qe,gi=[A({type:Number})],fi=[A({type:Number})],hi=[A({attribute:!1})],di=[A({attribute:!1})],ui=[A({attribute:!1})],Dt){constructor(){super(...arguments),Ce(this,fs,U(T,8,this,1)),U(T,11,this),Ce(this,gs,U(T,12,this,1)),U(T,15,this),Ce(this,ps,U(T,16,this)),U(T,19,this),Ce(this,vs,U(T,20,this)),U(T,23,this),Ce(this,_s,U(T,24,this)),U(T,27,this)}renderPageNumbers(){return Vo(Array.from({length:this.numberOfPages},(e,t)=>t+1),e=>D`
        <li>
            <button
                type="button"
                class="flex items-center justify-center px-3 h-8 leading-tight ${this.currentPage===e?"text-blue-600 bg-blue-100 dark:bg-gray-700 dark:text-white":"text-gray-500 bg-white dark:bg-gray-800 dark:text-gray-400"} border border-gray-300 hover:bg-gray-100 hover:text-gray-700 dark:border-darkborder dark:hover:bg-gray-700 dark:hover:text-white"
                @click=${()=>this.getPageFxn(e)}
            >
                ${e}
            </button>
        </li>
    `)}render(){return D`
    <nav aria-label="Page navigation example" class="flex items-center justify-center p-4">
      <ul class="inline-flex -space-x-px text-sm">
        <li>
          <button
            type="button"
            class="flex items-center justify-center px-3 h-8 ms-0 leading-tight text-gray-500 bg-white border border-e-0 border-gray-300 rounded-s-md hover:bg-gray-100 hover:text-gray-700 dark:bg-dark2 dark:border-darkborder dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
            @click=${()=>this.prevPage()}
            ?disabled=${this.currentPage===1}
          >Previous</button>
        </li>
        ${this.renderPageNumbers()}
        <li>
          <button
            type="button"
            class="flex items-center justify-center px-3 h-8 leading-tight text-gray-500 bg-white border border-gray-300 rounded-e-md hover:bg-gray-100 hover:text-gray-700 dark:bg-dark2 dark:border-darkborder dark:text-gray-400 dark:hover:bg-gray-700 dark:hover:text-white"
            @click=${()=>this.nextPage()}
            ?disabled=${this.currentPage===this.numberOfPages}
          >Next</button>
        </li>
      </ul>
    </nav>
    `}prevPage(){this.prevFxn()}nextPage(){this.nextFxn()}getPage(e){this.getPageFxn(e)}}T=Zo(Dt);fs=new WeakMap;gs=new WeakMap;ps=new WeakMap;vs=new WeakMap;_s=new WeakMap;Te(T,4,"currentPage",gi,Q,fs);Te(T,4,"numberOfPages",fi,Q,gs);Te(T,4,"nextFxn",hi,Q,ps);Te(T,4,"prevFxn",di,Q,vs);Te(T,4,"getPageFxn",ui,Q,_s);Q=Te(T,0,"WeeksRecordsPaginator",pi,Q);U(T,1,Q);window.Alpine=se;document.addEventListener("DOMContentLoaded",()=>{wi(),se.start()});
